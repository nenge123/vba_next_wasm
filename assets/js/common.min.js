!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e="undefined"!=typeof globalThis?globalThis:e||self)}(this,(function(e){"use strict";const{Array:t,Object:s,String:r,Number:a,Blob:n,File:o,ArrayBuffer:i,Uint8Array:c,Function:l,Boolean:p,Promise:u,FormData:d,URL:h,URLSearchParams:g,TextDecoder:y,TextEncoder:m,document:f,RegExp:w,HTMLElement:b,customElements:v,parseInt:A,Date:E,CustomEvent:S,JSON:x,indexedDB:C,undefined:j,DOMParser:L,prompt:F,alert:P,fetch:M,Response:z,Headers:T,XMLHttpRequest:I,location:R,matchMedia:k,styleMedia:B,Node:N,NodeList:U,StyleSheet:$,console:O,EventTarget:_,Worker:H,Text:J,Document:W,Symbol:G,CSSStyleDeclaration:K,NamedNodeMap:Z,Event:q,KeyboardEvent:V}=e,X=["success","error","progress","cancel","readystatechange","complete","change","message"],Q=["js","json","css","blob","xml","text","html"],Y=["CLIENT","UPCACHE"];class ee extends b{constructor(){super();const e=this;e.funName=ie.toUp("TAG_"+ie.RC(e.tagName,/-/g,"_"))+"_",le.BF(e.funName+"INIT",e)}connectedCallback(...e){le.BF(this.funName+"READY",this,...e)}attributeChangedCallback(...e){O.log(e),le.BF(this.funName+"ATTR",this,...e)}disconnectedCallback(...e){le.BF(this.funName+"REMOVE",this,...e)}}class te{tables=[];x;Store={};constructor(e,t){t=t||{},s.assign(this,{name:e,config:t}),le.StoreList[e]=this}open(e){var t=this;return ie.Async((s=>{let r=C.open(t.name,t.version);r.once("error",(async e=>{throw e})),r.once("upgradeneeded",e||(e=>{let s=e.target.result;ie.toArr(t.config,(e=>{var[t,r]=e;if(!s.objectStoreNames.contains(t)){var a=s.createObjectStore(t);ie.toArr(r,(e=>{e[1]&&e[1].options?a.createIndex(e[0],e[1].keyPath||e[0],e[1].options):a.createIndex(e[0],e[0],e[1]||{unique:!1})}))}}))})),r.once(X[0],(async r=>{let a=r.target.result;return t.tables=ie.toArr(a.objectStoreNames),t.version=a.version+1,t.check(t.config,t.tables).length>0?(a.close(),s(t.open(e))):(t.Store={},s(a))}))}))}check(e,t){return e=ie.toArr(e),t=ie.toArr(t),e.filter((e=>!t.includes(e[0])))}table(e){var t=this;return t.Store[e]||(t.Store[e]=new se(e,t)),t.Store[e]}async getTable(e,t){var s=this;s.config[e]||(s.config[e]=t||{}),s.db||(s.db=s.open());var r=await s.db;return s.check(s.config,s.tables).length>0&&(s.version+=1,r.close(),s.db=s.open(),r=await s.db),r}transaction(e,t,s){return s?s.transaction([e],t?j:"readwrite").objectStore(e):ie.Async((async s=>s(this.transaction(e,t,await this.getTable(e)))))}async clear(){var e=this;return e.db&&(await e.db).close(),e.db=j,C.deleteDatabase(e.name)}async delete(e){var t=this;t.db||ie.toArr(await C.databases(),(e=>{t.name===e.name&&(t.version=e.version+1)})),t.db=t.open((t=>{let s=t.target.result;ie.str(e)&&(e=[e]),ie.toArr(e,(e=>s.objectStoreNames.contains(e)&&s.deleteObjectStore(e)))}))}}class se{constructor(e,t,r){var a=this;s.assign(a,{table:e,IDB:t,opt:r,transaction:async s=>t.transaction(e,s,await t.getTable(e,r)),read:()=>a.transaction(!0),write:()=>a.transaction(!1),clear:async()=>a.toSuccess((await a.write()).clear()),count:async e=>a.toSuccess((await a.read()).count(e)),all:async(e,t)=>a.toSuccess((await a.read()).getAll(e,t)),keys:async(e,t)=>a.toSuccess((await a.read()).getAllKeys(e,t)),key:async e=>a.toSuccess((await a.read()).getKey(e)),load:(e,t)=>a.toSuccess(e.get(t)),save:(e,t,s)=>((ie.elm(t)||ie.elm(t.contents))&&(ie.elm(t)&&(t={contents:t}),t.tag=ie.toLow(t.contents.tagName||Q[6]),t.type=b.name,t.contents=t.contents.outerHTML),a.toSuccess(e.put(t,s))),cursor:async(e,t,s,r)=>(r?ie.await(r)&&(r=await r):r=await a.read(),a.getCursor(r.openCursor(t,s),e)),keyCursor:async(e,t,s,r)=>(r?ie.await(r)&&(r=await r):r=await a.read(),a.getCursor(r.openKeyCursor(t,s),e)),index:(e,t)=>new class{constructor(e,t){s.assign(this,{async transaction(){var t=await a.read();return t.indexNames.contains(e)?t.index(e):t},async cursor(e,s){return a.cursor(e,t,s,await this.transaction())},async keys(e,s){return a.keyCursor(e,t,s,await this.transaction())},async get(e,t,s){return a.get(e,t,s,await this.transaction())}})}}(e,t)})}toSuccess(e,t){return ie.Async((s=>e.on(X[0],(r=>{var a=e.result;t?t(s,a):s(a)}))))}getCursor(e,t){var s={};return this.toSuccess(e,((e,r)=>{if(r){if(ie.fn(t))return t(e,r);var{primaryKey:a,key:n,value:o}=r;o?ie.str(t)?o&&o[t]&&(s[a]=o[t]):s[a]=o:s[a]=n,r.continue()}else e(s)}))}async get(e,t,s,r){var a=this;if(r=r||await a.read(),ie.str(e)){let g=await a.load(r,e);if(ie.obj(g)&&g.contents){var{contents:n,type:i,tag:c,filesize:l,filetype:p,filename:u,version:d}=g;if(t&&d&&t!=d)return;if(i==b.name)n=le.docElm(n),c&&c!=Q[6]&&(n=n.querySelector(c));else if(!ie.str(n)&&l>le.maxsize&&n.length>0&&n.length!=l){ie.blob(n)&&(n.name&&(u=n.name),n.type&&(p=n.type));var h=e.split(le.part)[0];n=await ie.Async(ie.toArr(l/le.maxsize+1).map((async(t,s)=>{let o=h;return s>0&&(o+=le.part+s),e==o?n:(await a.load(r,o)).contents}))),n=ie.File(n,u||e,p),i!=o.name&&(n=await ie.toU8(n))}if(s)return n;g.contents=n}return g}if(ie.array(e))return ie.toObj(ie.Async(e.map((async e=>[e,await a.load(r,e)]))))}async put(e,t){var r=this,a=await r.write();if(t||ie.toArr(a.indexNames,(s=>{!t&&e[s]&&(t=e[s])})),ie.obj(e)&&e.contents){var{contents:n,filesize:o,filetype:i}=e;if(n&&(o||(o=n.size||n.length),i||(i=n.type||ce.getMime()),o&&o>le.maxsize))return delete e.contents,ie.Async(ie.toArr(o/le.maxsize+1).map((async(c,l)=>{let p=t;l>0&&(p+=le.part+l);var u=l*le.maxsize,d=await ie.toU8(n.slice(u,o-u>=le.maxsize?u+le.maxsize:o));return r.save(a,s.assign({contents:d,filesize:o,filetype:i,timestamp:new E},e)),p})))}return r.save(a,e,t)}async putdata(e,t,r,a){let n=s.assign({contents:t,timestamp:new E},a);return r&&(n.version=r),this.put(n,e)}async getdata(e,t){return this.get(e,t,!0)}async delete(e){var t=this,s=await t.write();return ie.str(e)?t.toSuccess(s.delete(e)):ie.array(e)?ie.Async(ie.Mach(e,(e=>t.toSuccess(s.delete(e),(t=>e))))):void 0}async remove(e){let t=this,s=await t.load(t.read(),e);if(ie.obj(s)){var{filesize:r}=s;if(r&&r>le.maxsize)return t.delete(ie.toArr(r/le.maxsize+1).map(((t,s)=>{let r=e.split(le.part)[0];return s>0&&(r+=le.part+s),r})))}return t.delete(e)}}class re extends _{ispack=/(zip|rar|7z)$/;unpackText="unpack:";downText="down:";constructor(e){super();var t=this;ie.str(e)?t.url=e:s.assign(t,e),e.libjs&&(t.store=le.LibStore,t.type=Q[3]),s.assign(t,{toProgress(e,s,r){ie.tryC(t,X[2],r+"("+ie.PER(e,s)+")",e,s)},toSuccess(e,s){t.toEvent(X[0],{result:e,headers:s})},toError(e){t.toSuccess(),ie.tryC(t,X[1],e,t)},toCancel(e){ie.tryC(e.body,X[3])},getItem:async(e,s)=>ie.tryC(t.DB,"get",e,s),async setItem(e,s,r,a){t.DB&&(r&&(e.contents=r),a&&(e.type=a),t.DB.put(e,s))},urlname:ce.getName(t.url)||"index.html",DB:le.getTable(t.store),result:ie.Async((e=>{t.once(X[0],(s=>{var{result:r,headers:a}=s.detail;ie.tryC(t,X[0],r,a),e(r)}))}))}),t.toSend()}async toSend(){var e,t,a=this,{urlname:n,type:i,libjs:l,libkey:p,store:u,key:d,unpack:h,filename:g,onLine:y,option:m,version:f,ispack:w,toSuccess:v,toCancel:A,toError:S}=a,x=e=>{v(e,t)},C=async()=>{if(L&&L.contents){var{filename:e,fileext:t,contents:s,type:r}=L;L="unpack"==r?await new ne({contents:s,Name:e,ext:t,progress:(e,t,s)=>a.toProgress(e,t,a.unpackText+s),password:L.password||a.password}).result:s}return x(L)};d=d||n,g=g||n,l&&(w.test(d)&&(d=p||le.LibPad+ie.RC(d,w,Q[0]),h=!0),le.LibStore);var L=await a.getItem(d,f);if(L&&(!y||!le.onLine))return C();var F=await a.response();if(ie.nil(F))return L?C():S({message:a.statusText});(t=ce.FilterHeader(ie.toObj(F.headers)||{})).filename||(t.filename=g);var{filetype:P,filesize:M,password:z}=t;if(z&&(a.password=z),"head"==i)return A(F),x(t);if(L){if(!L.filesize||M==L.filesize)return A(F),C();L=j}return 200!=F.status?S({message:(L=P==ce.getMime(Q[1])?await F.json():await F.text())||F.statusText,headers:t}):(M=(e=await a.steam(F,t)).size,i!=Q[3]?(e=await ie.toU8(e),a.Filter?e=await a.Filter(e,n,t):i&&(e=ie.decode(e,a.charset)),i==Q[1]?(e=ie.Json(e),i=Q[1]):i==Q[6]?(i=b.name,e=le.docElm(e)):i=ie.u8buf(e)?c.name:r.name):i=o.name,m=s.assign(m||{},{timestamp:new E,filename:g,filesize:M,filetype:P,type:i}),f&&(m.version=f),(ie.u8buf(e)||ie.blob(e))&&h?a.toPack(e,m,d,t):(a.setItem(m,d,e),x(e)))}async toPack(e,t,r,a){var n,i=this,l=await ce.CheckExt(e);if(l&&i.ispack.test(l)){var p,u=new ne({contents:e,Name:t.filename,ext:l,password:i.password,progress:(e,t,s)=>i.toProgress(e,t,i.unpackText+s)}),d=0;if(n=await u.result,ie.obj(n)){if(await ie.Async(ie.toArr(n).map((async e=>{var[s,a]=e;if(i.libjs){s=ce.getName(s);var l=ce.getMime(s),u=le.LibPad+s;a=i.reBuf(a,i.unbuf,s,l),await i.setItem({contents:a,filename:s,filesize:a.size||a.length,filetype:l,type:ie.blob(a)?o.name:ie.blob(a)?c.name:i.unbuf,version:t.version},u),u==r&&(p=a)}else d+=a.byteLength,n[s]=i.reBuf(a,i.unbuf)}))),p)return e=null,i.toSuccess(p,a);if(i.libjs&&n)return i.toSuccess(n,a)}e&&d&&(t.fileext=l,d>le.maxsize?(t.type="unpack",u.password&&(t.password=u.password)):(e=n,t.type=s.name))}if(await i.setItem(t,r,e),n)return i.toSuccess(n,a);i.toSuccess(e,a)}async steam(e,t){var{filename:s,type:r,length:a}=t,{body:n}=e;if(!n||!n.getReader)return e.blob();let o=0,i=0,c=await n.getReader(),l=[];for(;;){const{done:e,value:t}=await c.read();if(e)break;i=t.length,o+=i,this.toProgress(o,a,this.downText+s),l.push(t)}return ie.File(l,s,r)}reBuf(e,t,s,r){return t==Q[5]?e=ie.decode(e,this.charset):t==Q[1]?e=ie.Json(ie.decode(e,this.charset)):!t&&s&&(e=ie.File([e],s,r)),e}response(){var{url:e,get:t,post:r,head:a,json:n,headers:o}=this;let i={headers:new T(o||{})};return i.headers.set("ajax-fetch",1),s.assign(i,a),n?(r=ie.toJson(n),i.headers.set("accept",ce.getMime(Q[1]))):r&&(r=ie.toPost(r)),r&&(i.method="POST",i.body=r),M(ie.toGet(e,t),i).catch((e=>{this.statusText=e}))}}class ae extends _{headers={};total=0;constructor(e){super();const t=this;ie.str(e)?t.url=e:s.assign(t,e),s.assign(t,{toProgress(e,s,r,a){ie.tryC(t,e?t.progress:t.postProgress,a+ie.PER(s,r),s,r)},toSuccess(e,s){t.toEvent(X[0],{result:e,headers:s})},toError(e,s,r){t.toSuccess(),ie.tryC(t,X[1],e,s,r)},result:ie.Async((e=>t.once(X[0],(s=>{var{result:r,headers:a}=s.detail;ie.tryC(t,X[0],r,a),e(r)}))))}),t.url&&t.toSend()}getHeader(e){var t=ie.tryC(e,"getAllResponseHeaders").trim().split(/\n+/);return ce.FilterHeader(ie.toObj(ie.Mach(t,(e=>ie.Mach(e.split(/:\s+/),(e=>ie.RC(e.trim(),/^"(.+)"$/,"$1")))))))}toSend(){var e=this,{url:t,get:r,post:a,type:n,json:o,headers:i,paramsDictionary:c}=e;const l=new I(c);var p,u,d=ce.getName(t)||"index.html";l.on(X[4],(t=>{let s=l.readyState;if(2===s)p=e.getHeader(l),O.log(p),u=p.type,e.total=p.length||0,n?"head"==n&&l.abort():u==ce.getMime(Q[1])?l.responseType=Q[1]:u==ce.getMime(Q[4])?l.responseType=Q[4]:!p.filename&&/(text|html|javascript|css)/.test(u)||(l.responseType=Q[3]);else if(4===s){if("head"==n)return e.toSuccess(p);let t=l.response;return ie.blob(t)&&(t=ie.File([t],p.filename||d,u)),200==l.status?e.toSuccess(t,p):e.toError(l.statusText,p,l)}})),l.on(X[2],(t=>e.toProgress(!0,t.loaded,t.total,d))),l.upload.on(X[2],(t=>e.toProgress(!1,t.loaded,t.total,d)));var h=o?ie.toJson(o):a?ie.toPost(a):j;o&&s.assign(i,{accept:ce.getMime(Q[1]),"ajax-fetch":1}),n&&"head"!=n&&(l.responseType=n),l.open(h?"POST":"GET",ie.toGet(t,{inajax:E.now()},r)),ie.toArr(i,(e=>l.setRequestHeader(e[0],e[1]))),l.send(h)}}class ne extends _{src7z="extract7z.zip";srcrar="libunrar.min.zip";pwText="Enter password.";constructor(e){super(),s.assign(this,{toProgress(e,t,s){ie.tryC(this,X[2],e,t,s)},result:ie.Async((e=>this.once(X[0],(t=>e(t.detail)))))}),this.toDeData(e)}async toDeData(e){e&&!e.contents&&(e={contents:e});var{ext:t,contents:s}=e;t||(t=await ce.CheckExt(s)),O.log(t);var r=/zip$/.test(t)?new oe(e).result:this.rar(t,e);return this.toEvent(X[0],await r)}async loadUrl(e,t){var{src7z:s,srcrar:r}=this,a=/7z$/.test(e)?s:r;return await ce.getLibjs(a,t)}async rar(e,t){var{contents:s,password:r,progress:a}=t;if(s=await ie.toU8(s),!/(rar|7z)$/.test(e))return s;let n=await this.loadUrl(e,a);return n?ie.Async((e=>{let t,a=new H(n);a.on(X[7],(n=>{if(ie.obj(n.data)){var{t:o,data:i,file:c,total:l,current:p,name:u}=n.data;if(1==o)e(t||s);else{if(2==o)return!t&&(t={}),i&&(t[c]=i);if(4==o)return l>0&&l>=p&&this.toProgress(p,l,u||c);if(-1===o){if(r=F(this.pwText,r||ce.sp))return a.postMessage({password:r});e(s)}}a.terminate()}})),a.on(X[1],(t=>{e(s),a.terminate()})),a.onmessageerror=e=>a.toEvent(X[1]),a.postMessage({contents:s,password:r})})):s}}class oe extends _{zipsrc="zip.min.js";pwText="Enter password.";constructor(e){super();var t=this;ie.blob(e)||ie.buf(e)?t.contents=e:s.assign(t,e),s.assign(t,{toProgress(e,s,r){ie.tryC(t,X[2],e,s,r)},result:ie.Async((e=>t.once(X[0],(t=>e(t.detail)))))}),t.contents&&(t.pack?t.toEnData():t.toDeData())}async loadZip(){ie.nil(e.zip)&&await le.loadLibjs(this.zipsrc,this.progress)}async toEnData(){await this.loadZip();var{password:e,contents:t}=this;const s=new zip.BlobWriter,r=new zip.ZipWriter(s,{password:e});if(!t)return r;ie.buf(t)?r.add("unknow.data",new zip.BlobReader(ie.toBlob(t)),{onprogress:(e,t)=>this.toProgress(e,t),password:e}):ie.toArr(t).map((t=>r.add(t[0],new zip.BlobReader(ie.toBlob(t[1])),{onprogress:(e,s)=>this.toProgress(e,s,t[0]),password:e}))),await r.close({onprogress:(e,t)=>this.toProgress(e,t,"complete")}),this.toEvent(X[0],await s.getData())}async toDeData(){var{password:e,contents:t}=this;await this.loadZip(),new zip.ZipReader(ie.toBlob(t)).getEntries().then((async e=>{this.toEvent(X[0],e&&e.length?await this.getEntries(e):await ie.toU8(t))}))}async getEntries(e,t,s){if(ie.none(t)){var r,a=e.filter(((e,t)=>{if(ie.none(r)&&e.encrypted)return r=t,!0}))[0];if(a)return(a=await this.getEncrypted(a,this.password))?(e.splice(r,1),await this.getEntries(e,a[0],a[1])):j}return ie.toObj((s?[s]:[]).concat(await ie.Async(e.filter((e=>!e.directory)).map((async e=>[e.filename,await this.getData(e,t)])))))}async getData(e,t){return e.getData(new zip.Uint8ArrayWriter,{password:t,onprogress:(t,s)=>this.toProgress(t,s,e.filename)})}async getEncrypted(e,t){var s=await ie.Async((s=>{this.getData(e,t).catch((s=>(t=F(this.pwText,t))?this.getEncrypted(e,t):j)).then((e=>s(e)))}));return this.password=t,ie.u8buf(s)||ie.blob(s)?[t,[e.filename,s]]:s}}const ie={RC:(e,t,s)=>e&&e.replace(t,!ie.nil(s)&&s||ce.sp)||ce.sp,IF:(e,t)=>e instanceof t,IC:(e,t)=>!ie.nil(e)&&e.constructor===t,IP:e=>!ie.nil(e)&&e.prototype,Each:(e,t)=>t&&e.forEach(t)||e,Mach:(e,s)=>t.from(e,s),elm:e=>ie.IF(e,b),node:e=>ie.IF(e,N),nodelist:e=>ie.IF(e,U),await:e=>ie.IF(e,u),blob:e=>ie.IF(e,n),file:e=>ie.IF(e,o),fn:e=>ie.IF(e,l)&&(!ie.IP(e)||ie.IC(ie.IP(e),e)),func:e=>ie.fn(e),array:e=>t.isArray(e),obj:e=>ie.IC(e,s),buf:e=>ie.IC(e&&e.buffer||e,i),u8buf:e=>ie.IC(e,c),str:e=>ie.IC(e,r),bool:e=>ie.IC(e,p),num:e=>ie.IC(e,a),null:e=>null===e,none:e=>e===j,nil:e=>ie.null(e)||ie.none(e),hasOwnProp:(e,t)=>ie.hasProp(ie.IP(e),t),hasProp:(e,t)=>e.hasOwnProperty(t),toBuf:e=>e.arrayBuffer(),Blob2U8:async e=>ie.toU8(await ie.toBuf(e)),toBlob:e=>new n([e.buffer||e]),toU8:e=>ie.u8buf(e)?e:ie.blob(e)?ie.Blob2U8(e):new c(e.buffer||e),toStr:(e,t)=>e.toString(t),toUp:e=>e&&e.toUpperCase(),toLow:e=>e&&e.toLowerCase(),decode:(e,t)=>new y(t).decode(e),encode:e=>(new m).encode(e),toInt:(e,t)=>A(e,t),PER:(e,t)=>e&&e<=t?(100*e/t).toFixed(0)+"%":e?(e/1024).toFixed(1)+"KB":"0%",Async:(e,t)=>ie.array(e)?t?u.allSettled(e):u.all(e):ie.fn(e)?new u(e,t):u.resolve(e),setStyle:(e,t)=>(ie.toArr(t,(t=>(e.style||e).setProperty(t[0],t[1]))),e),getStyle:e=>ie.EachItem(e.style||e,!1),getAttr:e=>ie.EachItem(e.attributes||e,!1),setAttr:(e,t)=>(ie.toArr(t,(t=>(e.attributes||e).setAttribute(t[0],t[1]))),e),tryC:(e,t,...s)=>ie.tryA(e,t,s),tryA(e,t,s){if(!ie.nil(e))return t&&ie.str(t)&&(t=e[t]),ie.fn(t)?t.bind(e,...s)():j},toItem(e,t){var s=[];for(let n=0;n<e.length;n++){var r=e.item(n);if(t&&t(r))return!0;if(ie.str(r)){var a=ie.tryC(e,e.getPropertyValue,r);a?s.push([a,r]):s.push(r)}else r&&(2===r.nodeType?s.push([r.name,r.value]):s.push(r))}return s},toEntry(e,t){for(var s=[],r=e.entries(),a=0;;){var{done:n,value:o}=r.next();if(n)break;if(t&&t(o))return!0;o[0]===a?s.push(o[1]):s.push(o),a+=1}return s},EachItem(e,t){var r=[];return!0===t&&ie.array(e)||!1===t&&ie.obj(e)?e:(ie.str(e)?r=ie.Mach(e):ie.fn(e.entries)?r=ie.toEntry(e):e.item?r=ie.toItem(e):e.forEach?ie.Each(e,(e=>r.push(e))):ie.IF(e,s)&&(r=s.entries(e)),!1===t?s.fromEntries(r.map(((e,t)=>ie.array(e)&&2==e.length?e:[t,e]))):r)},getArr:e=>ie.array(e)?e:ie.obj(e)?s.entries(e):ie.num(e)||e.byteLength?ie.Mach(ie.toU8(e.buffer||e)):ie.EachItem(e,!0),define:(e,t,r,a,n)=>s.defineProperty(e,t,!a||ie.obj(r)&&r.value?r:{get:ie.fn(r)?r:()=>r,configurable:1==n}),defines:(e,t,r,a)=>r?ie.toArr(t,(t=>ie.define(e,t[0],t[1],1,a))):s.defineProperties(e,t),empty:e=>!e||0==e||(ie.str(e)?0==e.trim().length:0==ie.toArr(e).length),Json:e=>(ie.u8buf(e)&&(e=ie.decode(e)),ie.str(e)?new l("return "+e)():e),toJson:e=>x.stringify(ie.Json(e)),File:(e,t,s)=>new o(e,t,{type:s,lastModified:E.now()}),toPost(e){var t=e instanceof d?e:new d(e instanceof HTMLFormElement?e:j);return ie.obj(e)&&ie.toArr(e,(e=>t.append(e[0],e[1]))),t},toGet(e,...t){var[s,r]=e.split(/\?/);return r=new g(r),ie.Each(t,(e=>{ie.str(e)&&(e=new g(e)),ie.toArr(e,(e=>r.set(e[0],e[1])))})),s+(r.size?"?"+ie.toStr(r):ce.sp)},toObj:e=>ie.obj(e)?e:ie.EachItem(e,!1),toArr(e,t){if(!e)return[];let s=ie.getArr(e);return ie.Each(s,t)}},ce={Libjs:{},sp:"",p:R.pathname[0],async getLibjs(e,t,s,r,a){let n=ce.getName(e),o=ie.RC(n,/\.zip$/,".js");if(ce.Libjs[o])return ce.Libjs[o];s=s||le.version;let i=await le.getTable(le.LibStore).getdata(le.LibPad+o,s);return i||(i=await le.FetchItem({url:(/^[\w+\.\-\_]+$/.test(e)?le.JSpath+"lib/"+e:e)+"?"+E.now(),libkey:le.LibPad+o,libjs:!0,version:s,progress:t,Filter:r,unbuf:!!a&&Q[5]})),/json$/.test(o)?ce.Libjs[o]=i:i&&(ie.obj(i)?ie.toArr(i,(e=>ce.Libjs[e[0]]=e[1]&&ce.URL(e[1],e[0]))):ce.Libjs[o]=ce.URL(i,o)),i=null,ce.Libjs[o]},URL:(e,t)=>ie.str(e)&&e.length<255&&/^(blob|http|\/{1,2}(?!\*)|\.\/|.+\/)[^\n]*?$/i.test(e)?e:h.createObjectURL(ie.blob(e)?e:new n([e],{type:ce.getMime(t||ie.u8buf(e)&&ce.CheckExt(e)||Q[0])})),reURL:e=>h.revokeObjectURL(e),getPath(e){var t=ce.p;return e&&e.split(t).slice(0,-1).join(t)+t},getName(e){let t=(e=ie.RC(e,/^https?:\/\/[^\/\?\#\&]+/g)||ce.sp).split(ce.p).pop().split(/\?/)[0].split(/&/)[0].split(/#/)[0];return!t&&(e=e.match(/[^\/\?\&\#\=\*]+\.[a-z0-9A-Z]+/))?(O.log(e),e[0]||ce.sp):t||ce.sp},getExt:e=>ie.toLow(ce.getName(e).split(".").pop()),getKey:e=>ie.RC(ce.getName(e),/\.\w+$/),exttype:{},setMime(){ce.extlist=ie.toObj([].concat(..."text;css,scs,sass,html,xml,vml,style:css,htm:html,php:html,txt:plain\nimage;jpg,jpeg,png,gif,webp,avif,apng,heic,svg:svg+xml\nfont;woff,woff2,ttf,otf\napplication;pdf,json,js:javascript,0:octet-stream,zip:x-zip-compressed,rar:x-rar-compressed,7z:x-7z-compressed,wasm".split(/\n/).map((e=>(e=e.split(/;/),[].concat(e[1].split(/,/).map((t=>{t=t.split(/:/);var s=e[0]+ce.p+(t[1]||t[0]);return ce.exttype[s]=!0,[t[0],s]}))))))))},getMime:e=>(ce.extlist||ce.setMime(),e=e&&ie.toLow(e)||ce.sp,ce.exttype[e]||/^\w+\/[\w\;]+$/.test(e)?e:(/^\w+$/.test(e)||(e=ce.getExt(e)||e.split(".").pop()),O.log(e),ce.extlist[e]||ce.extlist[0])),FilterHeader:e=>(ie.toArr(e,(t=>{if(/content-/.test(t[0])){let s=decodeURI(t[1]);e[t[0]]=s;let r=ie.RC(t[0],/content-/);switch(r){case"disposition":let t=s.match(/^attachment;\s*filename=[\"\']+?(.+)[\"\']+?$/i);t&&t[1]&&(e.filename=decodeURI(t[1]));break;case"length":e.filesize=ie.toInt(s)||0;case"password":e[r]=s;break;case"type":s=ie.toLow(s);let a=s.split(/;/);e.filetype=s,e[r]=a[0].trim(),a[1]&&(e.charset=ie.toLow(a[1].split(/=/).pop().trim()));break}}})),e),head16:[["7z",/^377ABCAF271C/],["rar",/^52617221/],["zip",/^504B0304/],["png",/^89504E470D0A1A0A/],["gif",/^47494638(3761|3961)/],["jpg",/^FFD8FFE000104A464946/],["webp",/^52494646\w{8}57454250/],["pdf",/^255044462D312E/],["bmp",/^424D\w{4}0{8}/]],CheckExt(e){var t=ie.toU8(e.slice(0,16));return ie.await(t)?t.then((e=>ce.headType(e))):ce.headType(t)},headType(e){var t=ce.sp,s=ie.str(e)?e:ie.toUp(ie.Mach(e,(e=>ie.toStr(e,16).padStart(2,0))).join(t));return ie.toArr(ce.head16,(e=>{if(e[1].test(s))return t=e[0],!0})),t}},le=new class extends _{version=1;DB_NAME="XIUNOBBS";DB_STORE_MAP={libjs:{},myfile:{timestamp:!1}};LibStore="libjs";LibPad="script-";maxsize=104857600;part="-part-";lang={};StoreList={};isLocal=/^(127|localhost|172)/.test(R.host);CLASS=[ee,re,te,se,ne,oe,ae];getStore(e,t){return e&&e!=le.DB_NAME||(e=le.DB_NAME,t=t||le.DB_STORE_MAP),le.StoreList[e]||new te(e,t)}getTable(e,t,s){return e?ie.IF(e,se)?e:ie.str(e)?le.getStore(t,s).table(e):void 0:j}async FetchCache(e,t,s,r){t=t||Q[3];let a=await caches.open(r||le.DB_NAME),n=await a.match(e);if((!n||s&&new E-E.parse(n.headers.get("date"))>s)&&(n=await M(e),n&&a.put(n.url,n.clone())),n)return n[t]()}addJS(e,t,r,a){return ie.Async((a=>{r=r||ie.buf(e)&&(e.type&&/css$/.test(e.type)||e.name&&/css$/.test(e.name));var n=ce.URL(e),o=le.$ce(r?"link":"script");s.assign(o,{type:ce.getMime(r?Q[2]:Q[0]),href:n,src:n,rel:$.name,crossorigin:"anonymous",onload(s){e!=n&&ce.reURL(n),e=null,a(t&&t(s))},onerror(e){this.onload(e)}}),le.$append(r?f.head:f.body,o)}))}async loadLibjs(e,t,s,r,a){return await le.addJS(await ce.getLibjs(e,t,s,r,a),null,ce.getExt(e)==Q[2])}async unFile(e,t,r){return new ne(s.assign(r||{},{contents:e,progress:t})).result}customElement(e){!v.get(e)&&v.define(e,ee)}Err(e){return new Error(e)}async download(e,t,s){let r;!t&&e&&(t=e,e=null),/^(http|blob:|data:)/.test(t)?(r=t,!e&&/^(http|blob:)/.test(t)&&(e=ce.getName(t))):t&&(r=ce.URL(t,s)),e||(e=ie.file(t)&&t.name||ce.getMime(Q[3])+"."+(ie.u8buf(t)&&ce.CheckExt(t)||ce.getMime(Q[6])));let a=le.$ce("a");a.href=r,a.download=e,a.click(),a.remove()}triger(e,t,s){e=le.$(e),s||(s={detail:e}),e.dispatchEvent(new S(t,s))}toSet(e){(e=e||new class extends _{}).action=e.action||{};var{RF:t,CF:s,BF:r}=this;return ie.defines(e,{I:ie,T:le,F:ce,RF:{value:t},CF:{value:s},BF:{value:r}},!0),e}docload(e){f.readyState==X[5]?e.call(le):f.once("DOMContentLoaded",e)}$(e,t){return e?ie.str(e)?(t||f).querySelector(e):ie.fn(e)?le.docload(e):e:j}$$(e,t){return(t||f).querySelectorAll(e)||[]}$ce(e){return f.createElement(e)}$ca(e,t){return s.assign(le.$ce(e),t)}$ct(e,t,s){let r=le.$ce(e);return t&&(r.innerHTML=ie.str(t)?t:t()),ie.Attr(r,s?ie.str(s)?{class:s}:s:j),r}$append(e,t){return ie.str(t)&&(t=le.$ce(t)),e.appendChild(t),t}$add(e,t){return e.classList.add(t),e}async getItemAppend(e,t,s){let r=le.part,a=e.split(r)[0],n=ie.toArr(t.filesize/le.maxsize+1).map((async(n,o)=>{let i=a;return o>0&&(i+=r+o),e==i?t.contents:(await D.GET_ITEM(i,s)).contents})),o=ie.File(await ie.Async(n),a,t.filetype);return t.contents=null,o}docElm(e,t){return(new L).parseFromString(e,t||f.contentType).documentElement}RF(e,t){const s=this.action[e];return ie.fn(s)?ie.tryA(this,s,t||[]):s}CF(e,...t){return this.RF(e,t)}BF(e,t,...s){const r=this.action[e];return ie.fn(r)?ie.tryA(t,r,s):j}GL(e,t){return ie.none(le.lang[e])||(e=le.lang[e]),t?le.toReplace(e,t):e}toReplace(e,t){return ie.str(t)?e=ie.RC(e,/{value}/,t):ie.obj(t)&&ie.toArr(t,(t=>ie.RC(e,new w(t[0],"g"),t[1]))),e}MediaQuery(e,t){if(k){let s=k(e);return s.on(X[6],(e=>t(e.matches,e))),t(s.matches),s}}MediaMath(e){return B.matchMedium(e)}async toZip(e,t,s){return new oe({contents:e,progress:t,password:s,pack:!0}).result}FetchItem(e){return new re(e).result}ajax(e){return new ae(e).result}upload(e,t,s){le.$ca("input",{type:o.name,accept:t,multiple:s,onchange(t){var s=t.target.files;s.length&&ie.tryC(t,e,s),this.remove()},oncancel(e){this.remove()}}).click()}async PostMessage(e){le.SW.post(e)}SW=new class{constructor(e){var t=this,r=navigator.serviceWorker;s.assign(t,{async post(t){var s=r.controller||e.sw||r.ready&&(await r.ready).active;return s&&s.postMessage(t)},open(s){r.register(s).then((s=>{var r=s.installing||s.active;t.client(),f.on("visibilitychange",(e=>"visible"===f.visibilityState&&t.client())),e.PWAReady=ie.Async(!0),r.on("statechange",(s=>{e.sw=s.target,["redundant","activated"].includes(e.sw.state)&&t.client(),O.log(e.sw.state,2),e.CF("pwa_"+s.type,s)})),e.sw=r,t.pushManager=s.pushManager,s.pushManager.getSubscription().then((e=>{e&&O.log(e)}))}))},client(){t.post({action:Y[0],DB_NAME:e.DB_NAME,DB_STORE_MAP:e.DB_STORE_MAP,JSpath:e.JSpath})},clear(){r.getRegistrations().then((e=>ie.Each(e,(e=>e.unregister()))))},init(){var{post:s,clear:a}=t;return ie.Async((a=>{r?(r.on(X[1],(s=>{t.clear(),O.log(s),e.CF("pwa_"+s.type,s)})),r.on("controllerchange",(e=>{O.log(e.type),t.client()})),r.on(X[7],(async t=>{let r=t.data;if(ie.obj(r)){let{action:t,id:a}=r;if(t){if(t===Y[0]&&(e.CACHE_NAME=r.CACHE_NAME),ie.str(t)&&e.action[t])return a?s({action:a,result:await e.CF(t,r)}):e.CF(t,r);e.isLocal&&O.log(r)}}})),r.ready.then((t=>{e.sw=t.active,a(!0)}))):a(!1)}))},upCache(e){t.post({action:Y[1],result:e})}})}}(this);action={};constructor(){super();s.assign(_.prototype,{on(e,t,s){return this.addEventListener(e,t,s)},un(e,t,s){return this.removeEventListener(e,t,s)},once(e,t,r){return this.on(e,t,s.assign({passive:!1,once:!0},!0===r?{passive:!0}:r||{}))},toEvent(e,t){this.dispatchEvent(new S(e,{detail:t}))}});var{language:e,onLine:t}=navigator,{readyState:r,currentScript:a,characterSet:n}=f,o=a&&a.src.split(/\?/),i=o&&ce.getPath(o[0]),c=ie.toLow(e).split("-");"zh"==c[0]&&("cn"==c[1]?c[1]="hans":"hk"!=c[1]&&(c[1]="hant")),s.assign(this,{I:ie,F:ce,JSpath:i,ROOT:ce.getPath(R.href),langName:c[0],i18nName:c.join("-"),charset:ie.toLow(n),language:e,onLine:t,readyState:r,isTouch:ie.hasOwnProp(b,"ontouchstart"),PWAReady:this.SW.init()})}};e.onerror=(...e)=>P(e.join("\n")),s.assign(e,{T:le,F:ce,I:ie}),ie.defines(e,{Nenge:le},1)}));