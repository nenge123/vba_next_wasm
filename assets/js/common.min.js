!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e="undefined"!=typeof globalThis?globalThis:e||self)}(this,(function(e){"use strict";const{Array:t,Object:s,String:r,Number:a,Blob:n,File:o,ArrayBuffer:i,Uint8Array:c,Function:l,Boolean:u,Promise:p,FormData:d,URL:h,URLSearchParams:g,Text:m,TextDecoder:y,TextEncoder:f,document:w,RegExp:b,HTMLElement:v,customElements:E,Symbol:x,parseInt:A,addEventListener:j,removeEventListener:L,CSSStyleDeclaration:S,NamedNodeMap:C,Date:T,Event:F,CustomEvent:P,JSON:R,indexedDB:z,undefined:k,DOMParser:I,prompt:M,alert:B,fetch:U,XMLHttpRequest:N,location:O,matchMedia:$,styleMedia:H,Document:_,Node:W,NodeList:J,KeyboardEvent:G,StyleSheet:q,console:K,EventTarget:V}=e,Z=["success","error","progress"],X=["js","json"];class Q extends v{constructor(){super();const e=this;e.ElmName=ne.toUp("TAG_"+e.tagName.replace(/-/g,"_")),e.getFunc("INIT")}getFunc(e,t){let s=e?"_"+e:"",r=ie.action[this.ElmName+s];r&&r.apply(this,t||[])}connectedCallback(...e){this.getFunc(null,e),ie.docload((()=>this.getFunc("READY",e)))}attributeChangedCallback(...e){this.getFunc("ATTR",e)}disconnectedCallback(...e){this.getFunc("REMOVE",e)}}class Y{constructor(e,t){t=t||{},s.assign(this,{name:e,config:t,tables:[],Store:{}}),ie.StoreList[e]=this}open(e){var t=this;return ne.Async(((s,r)=>{let a=z.open(t.name,t.version);a.once("error",(async e=>{throw e})),a.once("upgradeneeded",e||(e=>{let s=e.target.result;ne.toArr(t.config,(e=>{var[t,r]=e;if(!s.objectStoreNames.contains(t)){var a=s.createObjectStore(t);K.log(e),ne.toArr(r,(e=>{e[1]&&e[1].options?a.createIndex(e[0],e[1].keyPath||e[0],e[1].options):a.createIndex(e[0],e[0],e[1]||{unique:!1})}))}}))})),a.once(Z[0],(async r=>{let a=r.target.result;return t.tables=ne.toArr(a.objectStoreNames),t.version=a.version+1,t.check(t.config,t.tables).length>0?(a.close(),s(t.open(e))):(t.Store={},s(a))}))}))}check(e,t){return e=ne.toArr(e),t=ne.toArr(t),e.filter((e=>!t.includes(e[0])))}table(e){var t=this;return t.Store[e]||(t.Store[e]=new ee(e,t)),t.Store[e]}async getTable(e,t){var s=this;s.config[e]||(s.config[e]=t||{}),s.db||(s.db=s.open());var r=await s.db;return s.check(s.config,s.tables).length>0&&(s.version+=1,r.close(),s.db=s.open(),r=await s.db),r}transaction(e,t,s){return s?s.transaction([e],t?k:"readwrite").objectStore(e):ne.Async((async s=>s(this.transaction(e,t,await this.getTable(e)))))}async clear(){var e=this;return e.db&&(await e.db).close(),e.db=k,z.deleteDatabase(e.name)}async delete(e){var t=this;t.db||ne.toArr(await z.databases(),(e=>{t.name===e.name&&(t.version=e.version+1)})),t.db=t.open((t=>{let s=t.target.result;ne.str(e)&&(e=[e]),ne.toArr(e,(e=>s.objectStoreNames.contains(e)&&s.deleteObjectStore(e)))}))}}class ee{constructor(e,t,r){s.assign(this,{table:e,IDB:t,opt:r,getDB:()=>t.getTable(e,r)})}async load(e,t){return this.success(e.get(t))}async save(e,t,s){return this.success(e.put(t,s))}success(e,t){return ne.Async((s=>e.on(Z[0],(r=>{var a=e.result;t?t(s,a):s(a)}))))}async transaction(e){var t=this;return t.IDB.transaction(t.table,e,await t.getDB())}get read(){return this.transaction(!0)}get write(){return this.transaction(!1)}getCursor(e,t){var s={};return this.success(e,((e,r)=>{if(r){if(ne.func(t))return t(e,r);var{primaryKey:a,key:n,value:o}=r;o?ne.str(t)?o&&o[t]&&(s[a]=o[t]):s[a]=o:s[a]=n,r.continue()}else e(s)}))}async get(e,t,s){var r=this,a=await r.read;if(ne.str(e)){let g=await r.load(a,e);if(ne.obj(g)&&g.contents){var{contents:n,type:i,tag:c,filesize:l,filetype:u,filename:p,version:d}=g;if(t&&d&&t!=d)return;if(i==v.name)n=ie.docElm(n),c&&(n=ie.$(c,n));else if(!ne.str(n)&&l>ie.maxsize&&n.length>0&&n.length!=l){ne.blob(n)&&(n.name&&(p=n.name),n.type&&(u=n.type));var h=e.split(ie.part)[0];n=await ne.Async(ne.toArr(l/ie.maxsize+1).map((async(t,s)=>{let o=h;return s>0&&(o+=ie.part+s),e==o?n:(await r.load(a,o)).contents}))),n=ne.File(n,p||e,u),i!=o.name&&(n=await ne.toU8(n))}if(s)return n;g.contents=n}return g}if(ne.array(e))return ne.toObj(ne.Async(e.map((async e=>[e,await r.load(a,e)]))))}async put(e,t){var r=this,a=await r.write;if(t||ne.toArr(a.indexNames,(s=>{!t&&e[s]&&(t=e[s])})),ne.obj(e)&&e.contents){var{contents:n,filesize:o,filetype:i}=e;if(n&&(o||(o=n.size||n.length),i||(i=n.type||oe.getMime("*")),o&&o>ie.maxsize))return delete e.contents,ne.Async(ne.toArr(o/ie.maxsize+1).map((async(c,l)=>{let u=t;l>0&&(u+=ie.part+l);var p=l*ie.maxsize,d=await ne.toU8(n.slice(p,o-p>=ie.maxsize?p+ie.maxsize:o));return r.save(a,s.assign({contents:d,filesize:o,filetype:i,timestamp:ie.date},e)),u})))}return r.save(a,e,t)}async putdata(e,t,r,a){let n=s.assign({contents:t,timestamp:ie.date},a);return r&&(n.version=r),this.put(n,e)}async getdata(e,t){return this.get(e,t,!0)}async delete(e){var t=this,s=await t.write;return ne.str(e)?t.success(s.delete(e)):ne.array(e)?ne.Async(ne.toArr(e).map((e=>t.success(s.delete(e),(t=>e))))):void 0}async remove(e){let t=this,s=await t.load(t.read,e);if(ne.obj(s)){var{filesize:r}=s;if(r&&r>ie.maxsize)return t.delete(ne.toArr(r/ie.maxsize+1).map(((t,s)=>{let r=e.split(ie.part)[0];return s>0&&(r+=ie.part+s),r})))}return t.delete(e)}async clear(){return this.success((await this.write).clear())}async count(e){return this.success((await this.read).count(e))}async all(e,t){return this.success((await this.read).getAll(e,t))}async keys(e,t){return this.success((await this.read).getAllKeys(e,t))}async key(e){return this.success((await this.read).getKey(e))}index(e){var t=this;return new class{get request(){return ne.Async((async s=>s((await t.read).index(e))))}async cursor(e,s,r){return t.cursor(e,s,r,await this.request)}async keys(e,s,r){return t.keyCursor(e,s,r,await this.request)}get(e){return t.load(this.request,e)}}}async cursor(e,t,s,r){return r?ne.await(r)&&(r=await r):r=await this.read,this.getCursor(r.openCursor(t,s),e)}async keyCursor(e,t,s,r){return r?ne.await(r)&&(r=await r):r=await this.read,this.getCursor(r.openKeyCursor(t,s),e)}}class te extends V{ispack=/(zip|rar|7z)$/;unpackText="unpack:";downText="down:";constructor(e){super();var t=this;ne.str(e)?t.url=e:s.assign(t,e),e.libjs&&(t.store=ie.LibStore,t.type=ne.L(n)),s.assign(t,{toProgress(e,s,r){ne.tryCall(t,t.progress,r+"("+ne.PER(e,s)+")",e,s)},toSuccess(e,s){t.toEvent(Z[0],{result:e,headers:s})},toError(e){t.toSuccess(),ne.tryCall(t,t.error,e,t)},toCancel(e){ne.tryCall(e.body,e.body.cancel)},getItem:async(e,s)=>ne.tryCall(t.DB,"get",e,s),async setItem(e,s,r,a){t.DB&&(r&&(e.contents=r),a&&(e.type=a),t.DB.put(e,s))},urlname:oe.getname(t.url)||"index.html",DB:ie.getTable(t.store),result:new p((e=>{t.once(Z[0],(function(s){var{result:r,headers:a}=s.detail;ne.tryCall(t,t.success,r,a),e(r)}))}))}),t.toSend()}async toSend(){var e,t,a=this,{urlname:i,type:l,libjs:u,store:p,key:d,unpack:h,filename:g,onLine:m,option:y,version:f,ispack:w,toSuccess:b,toCancel:E,toError:x}=a,A=e=>{b(e,t)},j=async()=>{if(L&&L.contents){var{filename:e,fileext:t,contents:s,type:r}=L;L="unpack"==r?await new re({contents:s,Name:e,ext:t,progress:(e,t,s)=>a.toProgress(e,t,a.unpackText+s),password:L.password||a.password}).result:s}return A(L)};d=d||i,g=g||i,u&&(w.test(d)&&(d=ie.LibPad+d.replace(w,"js"),h=!0),ie.LibStore);var L=await a.getItem(d,f);if(L&&(!m||!ie.onLine))return j();var S=await a.response();if(ne.nil(S))return L?j():x({message:a.statusText});(t=oe.FilterHeader(ne.toObj(S.headers)||{})).filename||(t.filename=g);var{filetype:C,filesize:T,password:F}=t;if(F&&(a.password=F),"head"==l)return E(S),A(t);if(L){if(!L.filesize||T==L.filesize)return E(S),j();L=k}return 200!=S.status?x({message:(L=C==oe.getMime(ie.ts[1])?await S.json():await S.text())||S.statusText,headers:t}):(T=(e=await a.steam(S,t)).size,l!=ne.L(n)?(e=await ne.toU8(e),a.Filter?e=await a.Filter(e,i,t):l&&(e=ne.decode(e,a.charset)),l==ie.ts[1]?(e=ne.Json(e),l=ie.ts[1]):l==ie.ts[2]?(l=v.name,e=ie.docElm(e)):l=ne.u8buf(e)?c.name:r.name):l=o.name,y=s.assign(y||{},{timestamp:ie.date,filename:g,filesize:T,filetype:C,type:l}),f&&(y.version=f),(ne.u8buf(e)||ne.blob(e))&&h?a.toPack(e,y,d,t):e?(a.setItem(y,d,e),A(e)):void 0)}async toPack(e,t,r,a){var n,i=this,l=await oe.CheckExt(e);if(l&&i.ispack.test(l)){var u,p=new re({contents:e,Name:t.filename,ext:l,password:i.password,progress:(e,t,s)=>i.toProgress(e,t,i.unpackText+s)}),d=0;if(n=await p.result,ne.obj(n)){if(await ne.Async(ne.toArr(n).map((async e=>{var[s,a]=e;if(i.libjs){s=oe.getname(s);var l=oe.getMime(s),p=ie.LibPad+s;a=i.reBuf(a,i.unbuf,s,l),await i.setItem({contents:a,filename:s,filesize:a.byteLength,filetype:l,type:ne.blob(a)?o.name:ne.blob(a)?c.name:i.unbuf,version:t.version},p),p==r&&(u=a)}else d+=a.byteLength,n[s]=i.reBuf(a,i.unbuf)}))),u)return e=null,i.toSuccess(u,a);if(i.libjs&&n)return i.toSuccess(n,a)}e&&d&&(t.fileext=l,d>ie.maxsize?(t.type="unpack",p.password&&(t.password=p.password)):(e=n,t.type=s.name))}if(await i.setItem(t,r,e),n)return i.toSuccess(n,a);i.toSuccess(e,a)}async steam(e,t){var{body:s}=e;if(!s||!s.getReader)return e.blob();var{filename:r,type:a,length:n}=t;let o=0,i=0,c=await s.getReader(),l=[];for(;;){const{done:e,value:t}=await c.read();if(e)break;i=t.length,o+=i,this.toProgress(o,n,this.downText+r),l.push(t)}return ne.File(l,r,a)}reBuf(e,t,s,r){return t==ie.ts[0]?e=ne.decode(e,this.charset):t==ie.ts[1]?e=ne.Json(ne.decode(e,this.charset)):!t&&s&&(e=ne.File([e],s,r)),e}response(){var{url:e,get:t,post:r,head:a,json:n,headers:o}=this;let i={headers:o||{}};return s.assign(i,a),n?(r=ne.toJson(ARG.json),i.headers.Accept=oe.getMime(ie.ts[1])):r&&(r=ne.toPost(ARG.post)),r&&(i.method="POST",i.body=r),U(ne.toGet(e,t),i).catch((e=>{this.statusText=e}))}}class se extends V{constructor(e){super();const t=this;ne.str(e)?t.url=e:s.assign(t,e),s.assign(t,{headers:{},total:0,toProgress(e,s,r,a){ne.tryCall(t,e?t.progress:t.postProgress,a+ne.PER(s,r),s,r)},toSuccess(e,s){t.toEvent(Z[0],{result:e,headers:s})},toError(e,s,r){t.toSuccess(),ne.tryCall(t,t.error,e,s,r)},result:new p((e=>t.once(Z[0],(s=>{var{result:r,headers:a}=s.detail;ne.tryCall(t,t.success,r,a),e(r)}))))}),t.url&&t.toSend()}getHeader(e){return oe.FilterHeader(ne.toObj((e.getAllResponseHeaders()||"").trim().split(/[\r\n]+/).map((e=>{let t=e.split(": ");return[t.shift(),t.join(": ")]}))))}toSend(){var e=this,{url:t,get:r,post:a,type:o,json:i,headers:c,paramsDictionary:l}=e;const u=new N(l);var p,d,h=oe.getname(t)||"index.html";u.on("readystatechange",(t=>{let s=u.readyState;if(2===s)p=e.getHeader(u),d=p.type,e.total=p.length||0,o?"head"==o&&u.abort():d==oe.getMime("json")?u.responseType="json":d==oe.getMime("xml")?u.responseType="xml":!p.filename&&/(text|html|javascript|css)/.test(d)||(u.responseType=ne.L(n));else if(4===s){if("head"==o)return e.toSuccess(p);let t=u.response;return ne.blob(t)&&(t=ne.File([t],p.filename||h,d)),200==u.status?e.toSuccess(t,p):e.toError(u.statusText||"net::ERR_FAILED",p,u)}})),u.on(Z[2],(t=>e.toProgress(!0,t.loaded,t.total,h))),u.upload.on(Z[2],(t=>e.toProgress(!1,t.loaded,t.total,h)));var g=i?ne.toJson(i):a?ne.toPost(a):k;i&&s.assign(c,{Accept:oe.getMime(X[1])}),"head"!=o&&(u.responseType=o),u.open(g?"POST":"GET",ne.toGet(t,{inajax:T.now()})),ne.toArr(c,(e=>u.setRequestHeader(e[0],e[1]))),u.send(g)}}class re extends V{src7z="extract7z.zip";srcrar="libunrar.min.zip";pwText="Enter password.";constructor(e){super(),ne.obj(e)||!ne.buf(e)&&!ne.blob(e)?s.assign(this,e):this.contents=e,s.assign(this,{toProgress(e,t,s){ne.tryCall(this,this.progress,e,t,s)},result:new p((e=>this.once(Z[0],(t=>e(t.detail)))))}),this.contents&&this.ondone()}async ondone(){var{ext:e,contents:t,password:s,progress:r,pwText:a}=this;if(e||(e=await oe.CheckExt(t)),/zip$/.test(e))return this.toEvent(Z[0],await new ae({contents:t,password:s,progress:r,pwText:a}).result);this.toEvent(Z[0],/(zip|rar|7z)$/.test(e)&&await this.rar(e)||await ne.toU8(t))}async rar(e){var{contents:t,password:s,progress:r,src7z:a,srcrar:n}=this,o=e&&/7z$/.test(e)?a:n;t=await ne.toU8(t);let i=await oe.getLibjs(o,r);return ne.Async((e=>{let r,a=new Worker(i),n=e=>a.terminate();a.onmessage=t=>{if(ne.obj(t.data)){var{t:o,data:i,file:c,total:l,current:u,name:p}=t.data;if(1==o)e(r||k);else{if(2==o)return!r&&(r={}),i&&(r[c]=i);if(4==o)return l>0&&l>=u&&this.toProgress(u,l,p||c);if(-1===o){if(s=M(this.pwText,s||""))return a.postMessage({password:s});e(k)}}n()}},a.onerror=t=>{e(k),n()},a.onmessageerror=a.onerror,a.postMessage({contents:t,password:s})}))}}class ae extends V{zipsrc="zip.min.js";pwText="Enter password.";constructor(e){super();var t=this;ne.blob(e)||ne.buf(e)?t.contents=e:s.assign(t,e),s.assign(t,{toProgress(e,s,r){ne.tryCall(t,t.progress,e,s,r)},result:new p((e=>t.once(Z[0],(t=>e(t.detail)))))}),t.contents&&(t.pack?t.toEnData():t.toDeData())}async loadjs(){ne.nil(e.zip)&&await ie.loadLibjs(this.zipsrc,this.progress)}async toEnData(){await this.loadjs();var{password:e,contents:t}=this;const s=new zip.BlobWriter,r=new zip.ZipWriter(s,{password:e});if(!t)return r;ne.buf(t)?r.add("unknow.data",new zip.BlobReader(ne.toBlob(t)),{onprogress:(e,t)=>this.toProgress(e,t),password:e}):ne.toArr(t).map((t=>r.add(t[0],new zip.BlobReader(ne.toBlob(t[1])),{onprogress:(e,s)=>this.toProgress(e,s,t[0]),password:e}))),await r.close({onprogress:(e,t)=>this.toProgress(e,t,"complete")}),this.toEvent(Z[0],await s.getData())}async toDeData(){var{password:e,contents:t}=this;await this.loadjs();var s=new zip.ZipReader(new zip.BlobReader(ne.blob(t)?t:ne.toBlob(t))),r=await s.getEntries();this.toEvent(Z[0],ne.empty(r)?k:await this.getEntries(r)||await ne.toU8(t))}async getEntries(e,t,s){if(ne.none(t)){var r,a=e.filter(((e,t)=>{if(ne.none(r)&&e.encrypted)return r=t,!0}))[0];if(a)return(a=await this.getEncrypted(a,this.password))?(e.splice(r,1),await this.getEntries(e,a[0],a[1])):k}return ne.toObj((s?[s]:[]).concat(await ne.Async(e.filter((e=>!e.directory)).map((async e=>[e.filename,await this.getData(e,t)])))))}async getData(e,t){return e.getData(new zip.Uint8ArrayWriter,{password:t,onprogress:(t,s)=>this.toProgress(t,s,e.filename)})}async getEncrypted(e,t){var s=await ne.Async((s=>{this.getData(e,t).catch((s=>(t=M(this.pwText,t))?this.getEncrypted(e,t):k)).then((e=>s(e)))}));return this.password=t,ne.u8buf(s)||ne.blob(s)?[t,[e.filename,s]]:s}}const ne={IF:(e,t)=>e instanceof t,IC:(e,t)=>ne.CS(e)===t,TP:e=>typeof e,N:e=>e.name||ne.CS(e)&&ne.CS(e).name||ne.TP(e),NC:e=>ne.toLow(ne.N(e)),R:(e,...t)=>Reflect.construct(e,t),L:e=>(ne.ST(e)||ne.N(e)||ne.toStr(e)).replace(/^(\w)/,(e=>ne.toLow(e))),C:e=>ne.CS(e),CS:e=>!ne.nil(e)&&e.constructor,DP:(e,t)=>Reflect.deleteProperty(e,t),Each:(e,t)=>t&&e.forEach(t)||e,NN:e=>ne.toLow(e.nodeName),ST:e=>ne.toLow(e[x.toStringTag]||""),dE:e=>(e||w).documentElement,dElm:(e,t)=>ne.dE((new I).parseFromString(e,t)),elm:e=>ne.IF(e,v),node:e=>ne.IF(e,W),nodelist:e=>ne.IF(e,J),await:e=>ne.IF(e,p),blob:e=>ne.IF(e,n),file:e=>ne.IF(e,o),func:e=>ne.IF(e,l)&&!ne.isClass(e),isClass:e=>/^class\s/.test(ne.toStr(e.constructor)),array:e=>t.isArray(e),obj:e=>ne.IC(e,s),buf:e=>ne.IC(e&&e.buffer||e,i),u8obj:e=>ne.IC(e,c),u8buf:e=>ne.u8obj(e),str:e=>ne.IC(e,r),toURL:e=>h.createObjectURL(e),reURL:e=>h.revokeObjectURL(e),bool:e=>ne.IC(e,u),num:e=>ne.IC(e,a),null:e=>null===e,none:e=>ne.TP(e)==ne.TP(),nil:e=>ne.null(e)||ne.none(e),Proto:e=>!ne.nil(e)&&e.prototype,hasOwnProp:(e,t)=>ne.hasProp(ne.Proto(e),t),hasProp:(e,t)=>e.hasOwnProperty(t),toBuf:e=>e.arrayBuffer(),Blob2U8:async e=>ne.toU8(await ne.toBuf(e)),toBlob:e=>new n([e.buffer||e]),toU8:e=>ne.u8buf(e)?e:ne.blob(e)?ne.Blob2U8(e):new c(e.buffer||e),U8:e=>ne.toU8(e),toStr:(e,t)=>e.toString(t),toUp:e=>e&&e.toUpperCase(),toLow:e=>e&&e.toLowerCase(),decode:(e,t)=>new y(t).decode(e),encode:e=>(new f).encode(e),Int:e=>ne.IntVal(e),IntVal:(e,t)=>A(e,t),PER:(e,t,s)=>e<=t?(100*e/t).toFixed(0)+"%":e?(e/1024).toFixed(1)+"KB":"0%",Async:(e,t)=>ne.array(e)?t?p.allSettled(e):p.all(e):ne.func(e)?new p(e):p.resolve(),setStyle:(e,t)=>(ne.toArr(t,(t=>(e.style||e).setProperty(t[0],t[1]))),e),getStyle:e=>ne.EachItem(e.style||e,!1),getAttr:e=>ne.EachItem(e.attributes||e,!1),setAttr:(e,t)=>(ne.toArr(t,(t=>(e.attributes||e).setAttribute(t[0],t[1]))),e),tryCall:(e,t,...s)=>ne.tryApply(e,t,s),tryApply(e,t,s){if(!ne.nil(e))return t&&ne.str(t)&&(t=e[t]),ne.func(t)?t.apply(e,s):k},EachItem(e,r){var a=[],n={};if(!0===r&&ne.array(e))return e;if(!1===r&&ne.obj(e))return e;if(ne.str(e))a=t.from(e);else if(ne.func(e.entries))for(var o=e.entries(),i=0;;){var{done:c,value:l}=o.next();if(c)break;l[0]===i?a.push(l[1]):a.push(l),i+=1}else if(e.item)for(let t=0;t<e.length;t++){var l=e.item(t);if(ne.str(l)){var u=ne.tryCall(e,e.getPropertyValue,l);u?n[u]=l:a.push(l)}else l&&(2===l.nodeType?a.push([l.name,l.value]):a.push(l))}else e.forEach&&ne.Each(e,(e=>a.push(e)));return!1===r?s.fromEntries(a.map(((e,t)=>ne.array(e)&&2==e.length?e:[t,e]))):a},getEntries:e=>ne.array(e)?e:ne.obj(e)?s.entries(e):ne.num(e)||e.byteLength?t.from(ne.toU8(e.buffer||e)):ne.EachItem(e,!0),define:(e,t,r,a,n)=>s.defineProperty(e,t,!a||ne.obj(r)&&r.value?r:{get:ne.func(r)?r:()=>r,configurable:1==n}),defines:(e,t,r,a)=>r?ne.toArr(t,(t=>ne.define(e,t[0],t[1],1,a))):s.defineProperties(e,t),empty:e=>!e||0==e||(ne.str(e)?0==e.trim().length:0==ne.toArr(e).length),Json:e=>(ne.u8buf(e)&&(e=ne.decode(e)),ne.str(e)?new l("return "+e)():e),toJson:e=>R.stringify(ne.Json(e)),progress(e,...t){e&&(t[0]+=" "+ne.PER(t[1],t[2]),e&&e.apply(t[3],t))},File:(e,t,s)=>new o(e,t,{type:s,lastModified:T.now()}),toPost(e){var t=e instanceof d?e:new d(e instanceof HTMLFormElement?e:k);return ne.obj(e)&&ne.toArr(e,(e=>t.append(e[0],e[1]))),t},toGet(e,...t){var[s,r]=e.split("?");return r=new g(r),ne.Each(t,(e=>{ne.str(e)&&(e=new g(e)),ne.toArr(e,(e=>r.set(e[0],e[1])))})),s+(r.size?"?"+ne.toStr(r):"")},toObj:e=>ne.obj(e)?e:ne.EachItem(e,!1),toArr(e,t){if(!e)return[];let s=ne.getEntries(e);return ne.Each(s,t)}},oe={Libjs:{},ext16:{"7z":/^377ABCAF271C/,rar:/^52617221/,zip:/^504B0304/,png:/^89504E470D0A1A0A/,gif:/^47494638(3761|3961)/,jpg:/^FFD8FFE000104A464946/,webp:/^52494646\w{8}57454250/,pdf:/^255044462D312E/,bmp:/^424D\w{4}0{8}/},exttype:{text:["css","scss","sass","html","htm","xml","vml",["style","css"],["html","html"],["php","html"],["txt","plain"]],image:["jpg","jpeg","png","gif","webp","avif","apng","heic",["svg","svg/xml"]],font:["woff","woff2","ttf","otf"],application:["pdf","json",["js","javascript"],["*","octet-stream"],["zip","x-zip-compressed"],["rar","x-rar-compressed"],["7z","x-7z-compressed"]]},CheckExt(e){let t=e.slice(0,16),s=ne.blob(t)?ne.toU8(t):ne.str(t)?ne.encode(t):t;return ne.await(s)?ne.Async((async e=>{e(oe.mimeHead(await s))})):oe.mimeHead(s)},async getLibjs(e,t,s,r,a){let n=oe.getname(e),o=n.replace(/\.zip$/,".js");if(oe.Libjs[n])return oe.Libjs[n];if(oe.Libjs[o])return oe.Libjs[o];s=s||ie.version;let i=await ie.getTable(ie.LibStore).getdata(ie.LibPad+o,s);return i||(i=await ie.FetchItem({url:ie.JSpath+"lib/"+e+"?"+ie.time,libjs:!0,version:s,progress:t,Filter:r,unbuf:!!a&&ie.ts[0]})),/json$/.test(o)?oe.Libjs[o]=i:i&&(ne.obj(i)?ne.toArr(i,(e=>oe.Libjs[e[0]]=e[1]&&oe.URL(e[1],e[0]))):oe.Libjs[o]=oe.URL(i,o)),i=null,oe.Libjs[o]},URL:(e,t)=>ne.str(e)&&e.length<255&&/^(blob|http|\/{1,2}(?!\*)|\.\/|.+\/)[^\n]*?$/i.test(e)?e:ne.toURL(ne.blob(e)?e:new n([e],{type:oe.getMime(t||ne.u8buf(e)&&oe.CheckExt(e)||"js")})),reURL:e=>ne.reURL(e),getname(e){let t=(e=e.replace(/^https?:\/\/[^\/\?\#\&]+/g,"")||"").split("/").pop().split("?")[0].split("&")[0].split("#")[0];return!t&&(e=e.match(/[^\/\?\&\#\=\*]+\.[a-z0-9A-Z]+/))?(K.log(e),e[0]||""):t||""},getExt:e=>ne.toLow(oe.getname(e).split(".").pop()),getKeyName:e=>oe.getname(e).replace(/\.\w+$/,""),getMime(e,t){let r;return e=e&&ne.toLow(e)||"",/^\w+\/[\w\;]+$/.test(e)?e:(e=oe.getExt(e)||e.split(".").pop(),oe.extlist||(oe.extlist=s.assign.apply({},ne.toArr(oe.exttype).map((e=>ne.array(e[1])?ne.toObj(e[1].map((t=>{if(ne.array(t))return[t[0],e[0]+"/"+t[1]];let s=e[0];return/\//.test(s)||(delete oe.exttype[s],s+="/"+t,oe.exttype[s]=!0),[t,s]}))):ne.obj(e[1])?ne.toObj(ne.toArr(e[1]).map((t=>[t[0],e[0]+"/"+t[1]]))):void 0)))),r=oe.extlist[e]||oe.extlist["*"],t&&/(text|javascript|xml|json)/.test(r)?r+";chartset=utf8":r)},getType:e=>(e=oe.getMime(e)).split("/").pop(),FilterHeader:e=>(ne.toArr(e,(t=>{if(/content-/.test(t[0])){let s=t[0].replace("content-",""),r=decodeURI(t[1]);switch(isFinite(r)&&(r=ne.IntVal(r)),s){case"disposition":let t=r.match(/^attachment;\s*filename=[\"\']+?(.+)[\"\']+?$/i);t&&t[1]&&(e.filename=decodeURI(t[1]));break;case"length":e.filesize=r;case"password":e[s]=r;break;case"type":r=ne.toLow(r);let a=r.split(";");e.filetype=r,e[s]=a[0].trim(),a[1]&&(e.charset=ne.toLow(a[1].split("=").pop().trim()));break}}})),e),ajaxHeader:e=>oe.FilterHeader(ne.toObj((e.getAllResponseHeaders()||"").trim().split(/[\r\n]+/).map((e=>{let t=e.split(": ");return[t.shift(),t.join(": ")]})).concat([["status",e.status],["statusText",e.statusText],["url",e.responseURL]]))),HtmltoStr(e){let t=e&&e.contents||e;return ne.elm(t)&&(ne.elm(e)&&(e={}),e.contents=t.outerHTML,e.tag=ne.NN(w.body),e.type=v.name),e},mimeHead(e){let t=ne.toUp(ne.toArr(e).map((e=>ne.toStr(e,16).padStart(2,"0"))).join("")),s=ne.toArr(oe.ext16).filter((e=>e[1].test(t)))[0];return s&&s[0]?s[0]:""}},ie=new class extends V{version=1;DB_NAME="XIUNOBBS";DB_STORE_MAP={libjs:{},myfile:{timestamp:!1}};LibStore="libjs";LibPad="script-";maxsize=104857600;part="-part-";lang={};action={};StoreList={};isLocal=/^(127|localhost|172)/.test(O.host);get I(){return ne}get F(){return oe}get date(){return new T}get time(){return T.now()}CLASS=[Q,te,Y,ee,re,ae,se];getStore(e,t){return e&&e!=ie.DB_NAME||(e=ie.DB_NAME,t=t||ie.DB_STORE_MAP),ie.StoreList[e]||new Y(e,t)}getTable(e,t,s){return e?ne.IF(e,ee)?e:ne.str(e)?ie.getStore(t,s).table(e):void 0:k}async FetchItem(e){return new te(e).result}ajax(e){return new se(e).result}async FetchCache(e,t,s,r){t=t||ne.L(n);let a=await caches.open(r||ie.DB_NAME),o=await a.match(e);if((!o||s&&ie.date-T.parse(o.headers.get("date"))>s)&&(o=await U(e),o&&a.put(o.url,o.clone())),o)return o[t]()}addJS(e,t,r,a){return ne.Async((a=>{r=r||ne.buf(e)&&(e.type&&/css$/.test(e.type)||e.name&&/css$/.test(e.name));var n=oe.URL(e),o=ie.$ce(r?"link":"script");s.assign(o,{type:oe.getMime(r?"css":"js"),href:n,src:n,rel:q.name,crossorigin:"anonymous",onload(s){e!=n&&oe.reURL(n),e=null,a(t&&t(s))},onerror(e){this.onload(e)}}),ie.$append(r?w.head:w.body,o)}))}async loadLibjs(e,t,s,r,a){return await ie.addJS(await oe.getLibjs(e,t,s,r,a),null,"css"==oe.getExt(e))}async unFile(e,t,r){return new re(s.assign(r||{},{contents:e,progress:t})).result}customElement(e){!E.get(e)&&E.define(e,Q)}Err(e){return new Error(e)}async download(e,t,s){let r;!t&&e&&(t=e,e=null),/^(http|blob:|data:)/.test(t)?(r=t,!e&&/^(http|blob:)/.test(t)&&(e=oe.getname(t))):t&&(r=oe.URL(t,s),e||(e=t.name||ie.ts[3]+"."+(await oe.CheckExt(t)||ie.ts[3])));let a=ie.$ce("a");a.href=r,a.download=e||"test.txt",a.click(),a.remove()}triger(e,t,s){e=ie.$(e),s||(s={detail:e}),e.dispatchEvent(new P(t,s))}setClass(e){(e=e||new class extends V{}).action=e.action||{};var{RF:t,CF:s,BF:r}=this;return ne.defines(e,{I:ne,T:ie,F:oe,RF:{value:t},CF:{value:s},BF:{value:r}},!0),e}onEvent(e,t,s,r,a){return e=ie.$(e),ne.Each(t.split(/\s+/),(t=>e.on(t,s,!1===r?{passive:!1}:r,a))),e}unEvent(e,t,s,r,a){return e=ie.$(e),ne.Each(t.split(/\s+/),(t=>e.un(t,s,!1===r?{passive:!1}:r,a))),e}onceEvent(e,t,s,r){return e.once(t,s,{passive:!1,once:!0},r)}docload(e){if(w.readyState!=ie.readyState)return e&&e.call(ie);w.once("DOMContentLoaded",e)}$(e,t){return e?ne.str(e)?(t||w).querySelector(e):ne.func(e)?ie.docload(e):e:k}$$(e,t){return(t||w).querySelectorAll(e)||[]}$ce(e){return w.createElement(e)}$ct(e,t,s){let r=ie.$ce(e);return t&&(r.innerHTML=ne.str(t)?t:t()),ne.Attr(r,s?ne.str(s)?{class:s}:s:k),r}$append(e,t){return ne.str(t)&&(t=ie.$ce(t)),e.appendChild(t),t}$add(e,t){return e.classList.add(t),e}async getItemAppend(e,t,s){let r=ie.part,a=e.split(r)[0],n=ne.toArr(t.filesize/ie.maxsize+1).map((async(n,o)=>{let i=a;return o>0&&(i+=r+o),e==i?t.contents:(await D.GET_ITEM(i,s)).contents})),o=ne.File(await ne.Async(n),a,t.filetype);return t.contents=null,o}docElm(e,t){return ne.dElm(e,t||w.contentType)}RF(e,t){const s=this.action[e];return ne.func(s)?ne.tryApply(this,s,t||[]):s}CF(e,...t){return this.RF(e,t)}BF(e,...t){const s=this.action[e],r=t.shift();return ne.func(s)?ne.tryApply(r,s,t):s}getLang(e,t){return ie.GL(e,t)}GL(e,t){return ne.none(ie.lang[e])||(e=ie.lang[e]),t?ie.toReplace(e,t):e}toReplace(e,t){return ne.str(t)?e=e.replace(/{value}/,t):ne.obj(t)&&ne.toArr(t,(t=>e.replace(new b(t[0],"g"),t[1]))),e}MediaQuery(e,t){if($){let s=$(e);s.on("change",(e=>t(e.matches,e))),t(s.matches)}}MediaMath(e){return H.matchMedium(e)}async toZip(e,t,s){return new ae({contents:e,progress:t,password:s,pack:!0}).result}PostMessage(e){var t=this.sw;return t&&t.postMessage(e)}async openServiceWorker(e){var{serviceWorker:t}=navigator;t.register(e).then((e=>{var t;e.installing?(t=e.installing,this._PWAReady(!0)):e.active&&(t=e.active),t.on("statechange",(e=>{this.sendClient(e.target.active),ie.CF("pwa_statechange",e)})),w.on("visibilitychange",(function(){"visible"===w.visibilityState&&ie.sendClient(t)})),this.sendClient(t),ie.sw=t,e.on("updatefound",(e=>{this.sendClient(e.target.active),ie.CF("pwa_updatefound",e)}))}))}clearWorker(e){navigator.serviceWorker.getRegistrations().then((t=>ne.Each(t,(t=>{t.active&&(e&&t.active.scriptURL.includes(e)?t.unregister():e||t.unregister())}))))}sendClient(e){e&&(e.postMessage({action:"CLIENT"}),e!=this.sw&&(this.sw=e))}setWorker(e){return e.on(Z[1],(function(e){ie.clearWorker(),ie.CF("pwa_error",e)})),e.on("message",(async function(e){let t=e.data;if(ie.isLocal&&K.log(t),ne.obj(t)){let{action:e,from:r,id:a}=t;if(e){if(ne.str(e)){if("GETDBNAME"==e)return ie.docload((()=>{ie.PostMessage({action:"WOKERDBNAME",result:ie.DB_NAME})}));let s=await ie.CF(e,t);a?(t.result=s,ie.PostMessage(t)):ie.PostMessage(s)}else if(ne.array(e)&&a){var s=ne.Async(e.map((e=>ie.CF(e))));t.result=s,ie.PostMessage(t)}}else r&&ie.CF(r,t)}})),!0}constructor(){super();var e=this;s.assign(V.prototype,{on(e,t,s){return this.addEventListener(e,t,s)},un(e,t,s){return this.removeEventListener(e,t,s)},once(e,t,r){return this.addEventListener(e,t,s.assign({passive:!1,once:!0},!0===r?{passive:!0}:r||{}))},toEvent(e,t){this.dispatchEvent(new P(e,{detail:t}))}});var{language:t,serviceWorker:a,onLine:n}=navigator,{contentType:o,readyState:i,ontouchend:c,currentScript:l,characterSet:u}=w,d=l&&l.src.split("?"),h=d&&d[0].split("/").slice(0,-1).join("/")+"/",g=ne.toLow(t).split("-");h&&(h=h.replace("static/","")),"zh"==g[0]&&("cn"==g[1]?g[1]="hans":"hk"!=g[1]&&(g[1]="hant")),s.assign(e,{JSpath:h,ROOT:h&&h.replace("assets/js/","")||O.pathname,langName:g[0],i18nName:g.join("-"),charset:ne.toLow(u),language:t,onLine:n,readyState:i,isTouch:ne.hasOwnProp(v,"ontouchstart"),ts:[ne.L(m),ne.L(R),oe.getType(o),o,ne.L(r)]}),a&&(e.setWorker(a),e.sw=a.controller,e.PWAReady=new p((t=>{e.sw?t(!0):e._PWAReady=t})))}};e.onerror=(e,t,s,r,a)=>B(e+s+t),e.T=ie,ne.defines(e,{Nenge:()=>ie},1)}));