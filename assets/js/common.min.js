!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e="undefined"!=typeof globalThis?globalThis:e||self)}(this,(function(e){"use strict";const{Array:t,Object:s,String:r,Number:a,Blob:n,File:i,ArrayBuffer:o,Uint8Array:c,Function:l,Boolean:p,Promise:u,FormData:d,URL:h,URLSearchParams:m,Text:g,TextDecoder:f,TextEncoder:y,document:w,RegExp:b,HTMLElement:v,customElements:E,Symbol:A,parseInt:L,addEventListener:j,removeEventListener:x,CSSStyleDeclaration:F,Date:S,Event:T,CustomEvent:z,ErrorEvent:R,JSON:C,indexedDB:I,IDBRequest:k,undefined:M,DOMParser:P,prompt:B,alert:U,fetch:N,XMLHttpRequest:$,location:O,matchMedia:_,styleMedia:W,Document:H,Node:J,NodeList:G,KeyboardEvent:q,StyleSheet:K,console:V,EventTarget:Z}=e,X=["success","error","progress"];class Q extends v{constructor(){super();const e=this;e.ElmName=re.toUp("TAG_"+e.tagName.replace(/-/g,"_")),e.getFunc("INIT")}getFunc(e,t){let s=e?"_"+e:"",r=ne.action[this.ElmName+s];r&&r.apply(this,t||[])}connectedCallback(...e){this.getFunc(null,e),ne.docload((()=>this.getFunc("READY",e)))}attributeChangedCallback(...e){this.getFunc("ATTR",e)}disconnectedCallback(...e){this.getFunc("REMOVE",e)}}class Y{constructor(e,t){t=t||{},s.assign(this,{name:e,config:t,tables:[],Store:{}}),ne.StoreList[e]=this}open(e){var t=this;return re.Async(((s,r)=>{let a=I.open(t.name,t.version);a.once("error",(async e=>{throw e})),a.once("upgradeneeded",e||(e=>{let s=e.target.result;re.toArr(t.config,(e=>{var[t,r]=e;if(!s.objectStoreNames.contains(t)){var a=s.createObjectStore(t);V.log(e),re.toArr(r,(e=>{e[1]&&e[1].options?a.createIndex(e[0],e[1].keyPath||e[0],e[1].options):a.createIndex(e[0],e[0],e[1]||{unique:!1})}))}}))})),a.once(X[0],(async r=>{let a=r.target.result;return t.tables=re.toArr(a.objectStoreNames),t.version=a.version+1,t.check(t.config,t.tables).length>0?(a.close(),s(t.open(e))):(t.Store={},s(a))}))}))}check(e,t){return e=re.toArr(e),t=re.toArr(t),e.filter((e=>!t.includes(e[0])))}table(e){var t=this;return t.Store[e]||(t.Store[e]=new ee(e,t)),t.Store[e]}async getTable(e,t){var s=this;s.config[e]||(s.config[e]=t||{}),s.db||(s.db=s.open());var r=await s.db;return s.check(s.config,s.tables).length>0&&(s.version+=1,r.close(),s.db=s.open(),r=await s.db),r}transaction(e,t,s){return s?s.transaction([e],t?M:"readwrite").objectStore(e):re.Async((async s=>s(this.transaction(e,t,await this.getTable(e)))))}async clear(){var e=this;return e.db&&(await e.db).close(),e.db=M,I.deleteDatabase(e.name)}async delete(e){var t=this;t.db||re.toArr(await I.databases(),(e=>{t.name===e.name&&(t.version=e.version+1)})),t.db=t.open((t=>{let s=t.target.result;re.str(e)&&(e=[e]),re.toArr(e,(e=>s.objectStoreNames.contains(e)&&s.deleteObjectStore(e)))}))}}class ee{constructor(e,t,r){s.assign(this,{table:e,IDB:t,opt:r,getDB:()=>t.getTable(e,r)})}async load(e,t){return this.success(e.get(t))}async save(e,t,s){return this.success(e.put(t,s))}success(e,t){return re.Async((s=>e.on(X[0],(r=>{var a=e.result;t?t(s,a):s(a)}))))}async transaction(e){var t=this;return t.IDB.transaction(t.table,e,await t.getDB())}get read(){return this.transaction(!0)}get write(){return this.transaction(!1)}getCursor(e,t){var s={};return this.success(e,((e,r)=>{if(r){if(re.func(t))return t(e,r);var{primaryKey:a,key:n,value:i}=r;i?re.str(t)?i&&i[t]&&(s[a]=i[t]):s[a]=i:s[a]=n,r.continue()}else e(s)}))}async get(e,t,s){var r=this,a=await r.read;if(re.str(e)){let m=await r.load(a,e);if(re.obj(m)&&m.contents){var{contents:n,type:o,tag:c,filesize:l,filetype:p,filename:u,version:d}=m;if(t&&d&&t!=d)return;if(o==v.name)n=ne.docElm(n),c&&(n=ne.$(c,n));else if(!re.str(n)&&l>ne.maxsize&&n.length>0&&n.length!=l){re.blob(n)&&(n.name&&(u=n.name),n.type&&(p=n.type));var h=e.split(ne.part)[0];n=await re.Async(re.toArr(l/ne.maxsize+1).map((async(t,s)=>{let i=h;return s>0&&(i+=ne.part+s),e==i?n:(await r.load(a,i)).contents}))),n=re.File(n,u||e,p),o!=i.name&&(n=await re.toU8(n))}if(s)return n;m.contents=n}return m}if(re.array(e))return re.toObj(re.Async(e.map((async e=>[e,await r.load(a,e)]))))}async put(e,t){var r=this,a=await r.write;if(t||re.toArr(a.indexNames,(s=>{!t&&e[s]&&(t=e[s])})),re.obj(e)&&e.contents){var{contents:n,filesize:i,filetype:o}=e;if(n&&(i||(i=n.size||n.length),o||(o=n.type||ae.getMime("*")),i&&i>ne.maxsize))return delete e.contents,re.Async(re.toArr(i/ne.maxsize+1).map((async(c,l)=>{let p=t;l>0&&(p+=ne.part+l);var u=l*ne.maxsize,d=await re.toU8(n.slice(u,i-u>=ne.maxsize?u+ne.maxsize:i));return r.save(a,s.assign({contents:d,filesize:i,filetype:o,timestamp:ne.date},e)),p})))}return r.save(a,e,t)}async putdata(e,t,r,a){let n=s.assign({contents:t,timestamp:ne.date},a);return r&&(n.version=r),this.put(n,e)}async getdata(e,t){return this.get(e,t,!0)}async delete(e){var t=this,s=await t.write;return re.str(e)?t.success(s.delete(e)):re.array(e)?re.Async(re.toArr(e).map((e=>t.success(s.delete(e),(t=>e))))):void 0}async remove(e){let t=this,s=await t.load(t.read,e);if(re.obj(s)){var{filesize:r}=s;if(r&&r>ne.maxsize)return t.delete(re.toArr(r/ne.maxsize+1).map(((t,s)=>{let r=e.split(ne.part)[0];return s>0&&(r+=ne.part+s),r})))}return t.delete(e)}async clear(){return this.success((await this.write).clear())}async count(e){return this.success((await this.read).count(e))}async all(e,t){return this.success((await this.read).getAll(e,t))}async keys(e,t){return this.success((await this.read).getAllKeys(e,t))}async key(e){return this.success((await this.read).getKey(e))}index(e){var t=this;return new class{get request(){return re.Async((async s=>s((await t.read).index(e))))}async cursor(e,s,r){return t.cursor(e,s,r,await this.request)}async keys(e,s,r){return t.keyCursor(e,s,r,await this.request)}get(e){return t.load(this.request,e)}}}async cursor(e,t,s,r){return r?re.await(r)&&(r=await r):r=await this.read,this.getCursor(r.openCursor(t,s),e)}async keyCursor(e,t,s,r){return r?re.await(r)&&(r=await r):r=await this.read,this.getCursor(r.openKeyCursor(t,s),e)}}class te extends Z{ispack=/(zip|rar|7z)$/;unpackText="unpack:";downText="down:";constructor(e){super();var t=this;re.str(e)?t.url=e:s.assign(t,e),e.libjs&&(t.store=ne.LibStore,t.type=re.L(n)),s.assign(t,{onprogress(e,s,r){t.progress&&t.progress(r+"("+(s?re.PER(e,s):e)+")",e,s)},onsuccess(e,s){t.toEvent(X[0],{result:e,headers:s})},onerror(e){t.onsuccess(),t.error&&t.error(e,t)},oncancel(e){e.body&&e.body.cancel()},getItem:async(e,s)=>t.DB&&t.DB.get(e,s),async setItem(e,s,r,a){t.DB&&(r&&(e.contents=r),a&&(e.type=a),t.DB.put(e,s))},urlname:ae.getname(t.url)||"index.html",DB:ne.getTable(t.store),result:new u((e=>{t.once(X[0],(function(s){var{result:r,headers:a}=s.detail;e(r),t.success&&t.success(r,a)}))}))}),t.onsend()}async onsend(){var e,t,a=this,{urlname:o,type:l,libjs:p,store:u,key:d,unpack:h,filename:m,onLine:g,option:f,version:y,ispack:w,onsuccess:b,oncancel:E,onerror:A}=a,L=e=>{b(e,t)},j=async()=>{if(x&&x.contents){var{filename:e,fileext:t,contents:s,type:r}=x;x="unpack"==r?await new se({contents:s,Name:e,ext:t,onprogress:(e,t,s)=>this.onprogress(e,t,this.unpackText+s),password:x.password||this.password}).result:s}return L(x)};d=d||o,m=m||o,p&&(w.test(d)&&(d=ne.LibPad+d.replace(w,"js"),h=!0),ne.LibStore);var x=await this.getItem(d,y);if(x&&(!g||!ne.onLine))return j();var F=await a.response();if(re.nil(F))return x?j():A({message:this.statusText});(t=ae.FilterHeader(re.toObj(F.headers)||{})).filename||(t.filename=m);var{filetype:S,filesize:T,password:z}=t;if(z&&(a.password=z),"head"==l)return E(F),L(t);if(x){if(!x.filesize||T==x.filesize)return E(F),j();x=M}return 200!=F.status?A({message:(x=S==ae.getMime(ne.ts[1])?await F.json():await F.text())||F.statusText,headers:t}):(T=(e=await a.steam(F,t)).size,l!=re.L(n)?(e=await re.toU8(e),this.Filter?e=await this.Filter(e,o,t):l&&(e=re.decode(e,this.charset)),l==ne.ts[1]?(e=re.Json(e),l=ne.ts[1]):l==ne.ts[2]?(l=v.name,e=ne.docElm(e)):l=re.u8buf(e)?c.name:r.name):l=i.name,f=s.assign(f||{},{timestamp:ne.date,filename:m,filesize:T,filetype:S,type:l}),y&&(f.version=y),(re.u8buf(e)||re.blob(e))&&h?this.onpack(e,f,d,t):e?(this.setItem(f,d,e),L(e)):void 0)}async onpack(e,t,r,a){var n,o=await ae.CheckExt(e);if(o&&this.ispack.test(o)){var l,p=new se({contents:e,Name:t.filename,ext:o,password:this.password,onprogress:(e,t,s)=>this.onprogress(e,t,this.unpackText+s)}),u=0;if(n=await p.result,re.obj(n)){if(await re.Async(re.toArr(n).map((async e=>{var[s,a]=e;if(this.libjs){s=ae.getname(s);var o=ae.getMime(s),p=ne.LibPad+s;a=this.reBuf(a,this.unbuf,s,o),await this.setItem({contents:a,filename:s,filesize:a.byteLength,filetype:o,type:re.blob(a)?i.name:re.blob(a)?c.name:this.unbuf,version:t.version},p),p==r&&(l=a)}else u+=a.byteLength,n[s]=this.reBuf(a,this.unbuf)}))),l)return e=null,this.onsuccess(l,a);if(this.libjs&&n)return this.onsuccess(n,a)}e&&u&&(t.fileext=o,u>ne.maxsize?(t.type="unpack",p.password&&(t.password=p.password)):(e=n,t.type=s.name))}if(await this.setItem(t,r,e),n)return this.onsuccess(n,a);this.onsuccess(e,a)}cancel(e){e.body&&e.body.cancel()}async steam(e,t){var{body:s}=e;if(!s||!s.getReader)return e.blob();var{filename:r,type:a,length:n}=t;let i=0,o=0,c=await s.getReader(),l=[];for(;;){const{done:e,value:t}=await c.read();if(e)break;o=t.length,i+=o;let s="";n&&i<=n?s=i:(s=`${(i/1024).toFixed(1)}KB`,n=0),this.onprogress(s,n,this.downText+r),l.push(t)}return re.File(l,r,a)}reBuf(e,t,s,r){return t==ne.ts[0]?e=re.decode(e,this.charset):t==ne.ts[1]?e=re.Json(re.decode(e,this.charset)):!t&&s&&(e=re.File([e],s,r)),e}response(){var{url:e,get:t,post:r,head:a,json:n,headers:i}=this;let o={headers:i||{}};return s.assign(o,a),n?(r=re.toJson(ARG.json),o.headers.Accept=ae.getMime(ne.ts[1])):r&&(r=re.toPost(ARG.post)),r&&(o.method="POST",o.body=r),N(re.toGet(e,t),o).catch((e=>{this.statusText=e}))}}class se extends Z{src7z="extract7z.zip";srcrar="libunrar.min.zip";constructor(e){super(),re.obj(e)||!re.buf(e)&&!re.blob(e)?s.assign(this,e):this.contents=e,this.on(X[2],(function(e){this.onprogress&&this.onprogress.apply(this,e.detail)})),this.result=new u((e=>{this.once(X[0],(function(t){var{detail:s}=t;e(s),this.success&&this.success(s)}))})),this.contents&&this.ondone()}async ondone(){var{ext:e,contents:t}=this;e||(e=await ae.CheckExt(t));var s=/(zip|rar|7z)$/.test(e)&&(/zip$/.test(e)&&await this.zip()||await this.rar(e))||await re.toU8(t);this.toEvent(X[0],s)}async extractor(e){return re.Async((async t=>{ae.getLibjs("extractor-new.min.zip").catch((e=>t())).then((s=>{if(!s)return t();var r,a,i=new Worker(s),o={},l=0;i.onmessage=e=>{var{file:s,data:p,size:u,end:d,total:h,error:m}=e.data;h?a=h:d?(re.Async(re.toArr(o).map((async e=>{var[t,s]=e;return[t,s.length?await re.toU8(new n(s)):new c]}))).then((e=>{e=e.length?re.toObj(e):M,t(e)})),i.terminate()):s&&!/\/$/.test(s)?(o[s]=[],r=s):p&&r?(l+=u,o[r].push(p)):m&&!o[r].length&&delete o[r],r&&this.toEvent(X[2],[l,a,r])},i.onerror=e=>{i.terminate(),t()},i.onmessageerror=i.onerror,i.postMessage({filename:this.Name||"test."+(e||"zip"),data:this.contents,DB_NAME:ne.DB_NAME,DB_TABLE:ne.LibStore,DB_FILE:ne.LibPad+"extractor-new.wasm"})}))}))}async rar(e){var{contents:t,password:s,onprogress:r,src7z:a,srcrar:n}=this,i=e&&/7z$/.test(e)?a:n;t=await re.toU8(t);let o=await ae.getLibjs(i,r);return re.Async((e=>{let r,a=new Worker(o),n=e=>a.terminate();a.onmessage=t=>{if(re.obj(t.data)){var{t:i,data:o,file:c,total:l,current:p,name:u}=t.data;if(1==i)e(r||M);else{if(2==i)return!r&&(r={}),o&&(r[c]=o);if(4==i)return l>0&&l>=p&&this.toEvent(X[2],[p,l,u||c]);if(-1===i){if(s=B("Enter password.",s||""))return a.postMessage({password:s});e(M)}}n()}},a.onerror=t=>{e(M),n()},a.onmessageerror=a.onerror,a.postMessage({contents:t,password:s})}))}async getEntries(e,t,s){if(re.none(t)){var r,a=e.filter(((e,t)=>{if(re.none(r)&&e.encrypted)return r=t,!0}))[0];if(a)return(a=await this.getEncrypted(a,this.password))?(e.splice(r,1),await this.getEntries(e,a[0],a[1])):M}return re.toObj((s?[s]:[]).concat(await re.Async(e.filter((e=>!e.directory)).map((async e=>[e.filename,await this.getData(e,t)])))))}async getData(e,t){return e.getData(new zip.Uint8ArrayWriter,{password:t,onprogress:(t,s)=>this.toEvent(X[2],[t,s,e.filename])})}async getEncrypted(e,t){var s=await re.Async((s=>{this.getData(e,t).catch((s=>(t=B("Enter password.",t))?this.getEncrypted(e,t):M)).then((e=>s(e)))}));return this.password=t,re.u8buf(s)||re.blob(s)?[t,[e.filename,s]]:s}async zip(){var{contents:t}=this;typeof e.zip===re.TP()&&await ne.loadLibjs(ne.zipsrc,this.onprogress),re.blob(t)||(t=new n([t.buffer||t],{type:ae.getMime("*")}));var s=new zip.ZipReader(new zip.BlobReader(t)),r=await s.getEntries();if(!re.empty(r))return await this.getEntries(r)}}const re={IF:(e,t)=>e instanceof t,IC:(e,t)=>re.CS(e)===t,TP:e=>typeof e,N:e=>e.name||re.CS(e)&&re.CS(e).name||re.TP(e),NC:e=>re.toLow(re.N(e)),R:(e,...t)=>Reflect.construct(e,t),L:e=>(re.ST(e)||re.N(e)||re.toStr(e)).replace(/^(\w)/,(e=>re.toLow(e))),C:e=>re.CS(e),CS:e=>!re.nil(e)&&e.constructor,DP:(e,t)=>Reflect.deleteProperty(e,t),FE:(e,t)=>t&&e.forEach&&e.forEach(t)||e,FM:(e,t)=>t&&e.map&&e.map(t)||e,NN:e=>re.toLow(e.nodeName),ST:e=>re.toLow(e[A.toStringTag]||""),dE:e=>(e||w).documentElement,dElm:(e,t)=>re.dE((new P).parseFromString(e,t)),elm:e=>re.IF(e,v),node:e=>re.IF(e,J),nodelist:e=>re.IF(e,G),isDoc:e=>re.IF(e,H),await:e=>re.IF(e,u),blob:e=>re.IF(e,n),file:e=>re.IF(e,i),evt:e=>re.IF(e,T),keyevt:e=>re.IF(e,q),func:e=>re.IF(e,l)&&!re.isClass(e),isClass:e=>/^class\s/.test(re.toStr(e.constructor)),array:e=>t.isArray(e),obj:e=>re.IC(e,s),buf:e=>re.IC(e&&e.buffer||e,o),u8obj:e=>re.IC(e,c),u8buf:e=>re.u8obj(e),str:e=>re.IC(e,r),toURL:e=>h.createObjectURL(e),reURL:e=>h.revokeObjectURL(e),bool:e=>re.IC(e,p),num:e=>re.IC(e,a),null:e=>null===e,none:e=>re.TP(e)==re.TP(),nil:e=>re.null(e)||re.none(e),Arr:e=>new t(e),ArrFrom:e=>t.from(e),Proto:e=>!re.nil(e)&&e.prototype,hasOwnProp:(e,t)=>re.hasProp(re.Proto(e),t),hasProp:(e,t)=>e.hasOwnProperty(t),toBuf:e=>e.arrayBuffer(),Blob2U8:async e=>re.toU8(await re.toBuf(e)),toU8:e=>re.u8buf(e)?e:re.blob(e)?re.Blob2U8(e):new c(e.buffer||e),U8:e=>re.toU8(e),toStr:(e,t)=>e.toString(t),toUp:e=>e&&e.toUpperCase(),toLow:e=>e&&e.toLowerCase(),decode:(e,t)=>new f(t).decode(e),encode:e=>(new y).encode(e),isForm:e=>re.IF(e,d),setForm:e=>new d(e),setParam:e=>new m(e),Int:e=>re.IntVal(e),IntVal:(e,t)=>L(e,t),PER:(e,...t)=>re.Int(100*e/t[0]).toFixed(0)+(t[1]?"":"%"),Async:(e,t)=>re.array(e)?t?u.allSettled(e):u.all(e):re.func(e)?new u(e):u.resolve(),setStyle:(e,t)=>(re.toArr(t,(t=>(e.style||e).setProperty(t[0],t[1]))),e),getStyle:e=>re.EachItem(e.style||e),getAttr:e=>re.EachItem(e.attributes||e),setAttr:(e,t)=>(re.toArr(t,(t=>(e.style||e).setAttribute(t[0],t[1]))),e),toApply:(e,...t)=>e&&Reflect.apply(e,t.shift(),t),EachItem(e,r){var a=[],n={};if(re.str(e))a=t.from(e);else if(e.forEach)!0===r?e.forEach((e=>a.push(e))):e.forEach(((e,t)=>re.array(e)&&2==e.length?n[e[0]]=e[1]:n[t]=e));else if(e.item)for(let t=0;t<e.length;t++){var i,o=e.item(t);if(re.str(o))(i=re.toApply(e.getPropertyValue,e,o))?n[i]=o:a.push(o);else o&&(o instanceof J?n[o.name]=o.value:a.push(o))}else if(re.func(e.entries))for(var c=e.entries();;){var l=c.next();if(l.done)break;if(re.array(l.value)){var[i,o]=l.value;r?re.num(i)?a.push(o):a.push(l.value):n[i]=o}else a.push(l.value)}return!0===r&&(n=s.entries(n)),a.length?!1===r?s.fromEntries(a.map(((e,t)=>re.array(e)&&2==e.length?e:[t,e]))):a:n},getEntries:e=>re.array(e)?e:re.obj(e)?s.entries(e):re.num(e)||e.byteLength?re.ArrFrom(re.toU8(e.buffer||e)):re.EachItem(e,!0),define:(e,t,r,a,n)=>s.defineProperty(e,t,!a||re.obj(r)&&r.value?r:{get:re.func(r)?r:()=>r,configurable:1==n}),defines:(e,t,r,a)=>r?re.toArr(t,(t=>re.define(e,t[0],t[1],1,a))):s.defineProperties(e,t),empty:e=>!e||0==e||(re.str(e)?0==e.trim().length:0==re.toArr(e).length),Json:e=>(re.u8buf(e)&&(e=re.decode(e)),re.str(e)?new l("return "+e)():e),toJson:e=>C.stringify(re.Json(e)),progress(e,...t){e&&(t[0]+=" "+re.PER(t[1],t[2]),e&&e.apply(t[3],t))},File:(e,t,s)=>new i(e,t,{type:s,lastModified:S.now()}),toPost(e){let t=re.isForm(e)?e:re.setForm(re.elm(e)?e:re.str(e)?ne.$(e):M);return re.obj(e)&&re.toArr(e,(e=>t.append(e[0],e[1]))),t},toGet(e,...t){let s=e.split("?"),r=s[1]&&s[1].split("#")[0]||"",a=re.toArr(re.toObj(re.setParam(r+"&"+t.map((e=>re.obj(e)?re.setParam(e):e)).join("&")))).map((e=>e[0]+"="+e[1])).join("&").replace(/=&/g,"&");return s[0]+(a?"?"+a:"")},toObj:e=>re.obj(e)?e:re.EachItem(e,!1),toArr(e,t){if(!e)return[];let s=re.getEntries(e);return re.func(t)?re.FE(s,t):s}},ae={Libjs:{},ext16:{"7z":/^377ABCAF271C/,rar:/^52617221/,zip:/^504B0304/,png:/^89504E470D0A1A0A/,gif:/^47494638(3761|3961)/,jpg:/^FFD8FFE000104A464946/,webp:/^52494646\w{8}57454250/,pdf:/^255044462D312E/,bmp:/^424D\w{4}0{8}/},exttype:{text:["css","scss","sass","html","htm","xml","vml",["style","css"],["html","html"],["php","html"],["txt","plain"]],image:["jpg","jpeg","png","gif","webp","avif","apng","heic",["svg","svg/xml"]],font:["woff","woff2","ttf","otf"],application:["pdf","json",["js","javascript"],["*","octet-stream"],["zip","x-zip-compressed"],["rar","x-rar-compressed"],["7z","x-7z-compressed"]]},CheckExt(e){let t=e.slice(0,16),s=re.blob(t)?re.toU8(t):re.str(t)?re.encode(t):t;return re.await(s)?re.Async((async e=>{e(ae.mimeHead(await s))})):ae.mimeHead(s)},async getLibjs(e,t,s,r,a){let n=ae.getname(e),i=n.replace(/\.zip$/,".js");if(ae.Libjs[n])return ae.Libjs[n];if(ae.Libjs[i])return ae.Libjs[i];s=s||ne.version;let o=await ne.getTable(ne.LibStore).getdata(ne.LibPad+i,s);return o||(o=await ne.FetchItem({url:ne.JSpath+"lib/"+e+"?"+ne.time,libjs:!0,version:s,progress:t,Filter:r,unbuf:!!a&&ne.ts[0]})),/json$/.test(i)?ae.Libjs[i]=o:o&&(re.obj(o)?re.toArr(o,(e=>ae.Libjs[e[0]]=e[1]&&ae.URL(e[1],e[0]))):ae.Libjs[i]=ae.URL(o,i)),o=null,ae.Libjs[i]},URL:(e,t)=>re.str(e)&&e.length<255&&/^(blob|http|\/{1,2}(?!\*)|\.\/|.+\/)[^\n]*?$/i.test(e)?e:re.toURL(re.blob(e)?e:new n([e],{type:ae.getMime(t||re.u8buf(e)&&ae.CheckExt(e)||"js")})),reURL:e=>re.reURL(e),getname(e){let t=(e||"").split("/").pop().split("?")[0].split("&")[0].split("#")[0];return!e||t&&/\.\w+$/.test(t)?t||"":(e=e.match(/(\?|\&)?([^\&]+\.[a-z0-9A-Z]+)\&?/))&&e[2]||""},getExt:e=>re.toLow(ae.getname(e).split(".").pop()),getKeyName:e=>ae.getname(e).replace(/\.\w+$/,""),getMime(e,t){let r;return e=e&&re.toLow(e)||"",/^\w+\/[\w\;]+$/.test(e)?e:(e=ae.getExt(e)||e.split(".").pop(),ae.extlist||(ae.extlist=s.assign.apply({},re.toArr(ae.exttype).map((e=>re.array(e[1])?re.toObj(e[1].map((t=>{if(re.array(t))return[t[0],e[0]+"/"+t[1]];let s=e[0];return/\//.test(s)||(delete ae.exttype[s],s+="/"+t,ae.exttype[s]=!0),[t,s]}))):re.obj(e[1])?re.toObj(re.toArr(e[1]).map((t=>[t[0],e[0]+"/"+t[1]]))):void 0)))),r=ae.extlist[e]||ae.extlist["*"],t&&/(text|javascript|xml|json)/.test(r)?r+";chartset=utf8":r)},getType:e=>(e=ae.getMime(e)).split("/").pop(),FilterHeader:e=>(re.toArr(e,(t=>{if(/content-/.test(t[0])){let s=t[0].replace("content-",""),r=decodeURI(t[1]);switch(isFinite(r)&&(r=re.IntVal(r)),s){case"disposition":let t=r.match(/^attachment;\s*filename=[\"\']+?(.+)[\"\']+?$/i);t&&t[1]&&(e.filename=decodeURI(t[1]));break;case"length":e.filesize=r;case"password":e[s]=r;break;case"type":r=re.toLow(r);let a=r.split(";");e.filetype=r,e[s]=a[0].trim(),a[1]&&(e.charset=re.toLow(a[1].split("=").pop().trim()));break}}})),e),ajaxHeader:e=>ae.FilterHeader(re.toObj((e.getAllResponseHeaders()||"").trim().split(/[\r\n]+/).map((e=>{let t=e.split(": ");return[t.shift(),t.join(": ")]})).concat([["status",e.status],["statusText",e.statusText],["url",e.responseURL]]))),HtmltoStr(e){re.elm(e)&&!e.contents&&(e={contents:e});let t=e&&e.contents;return re.elm(t)&&(e.contents=t.outerHTML,e.tag=re.NN(w.body),e.type=v.name),e},mimeHead(e){let t=re.toUp(re.toArr(e).map((e=>re.toStr(e,16).padStart(2,"0"))).join("")),s=re.toArr(ae.ext16).filter((e=>e[1].test(t)))[0];return s&&s[0]?s[0]:""}},ne=new class extends Z{version=1;DB_NAME="XIUNOBBS";DB_STORE_MAP={libjs:{},myfile:{timestamp:!1}};LibStore="libjs";LibPad="script-";maxsize=104857600;part="-part-";lang={};action={};StoreList={};isLocal=/^(127|localhost|172)/.test(O.host);zipsrc="zip.min.js";get I(){return re}get F(){return ae}get date(){return new S}get time(){return S.now}CLASS=[Q,te,Y,ee,se];getStore(e,t){return e&&e!=ne.DB_NAME||(e=ne.DB_NAME,t=t||ne.DB_STORE_MAP),ne.StoreList[e]||new Y(e,t)}getTable(e,t,s){return e?re.IF(e,ee)?e:re.str(e)?ne.getStore(t,s).table(e):void 0:M}async FetchItem(e){return new te(e).result}ajax(e){return e=s.assign({url:O.href},e||{}),re.Async((t=>{const r=new $(e.paramsDictionary),a=ne.ts;let i,o,c=(...s)=>{e.success&&e.success.apply(r,s),t(s[0])},l="head";r.on("readystatechange",(s=>{let p=r.readyState;if(2===p)i=ae.ajaxHeader(r),o=i.type,e.type?e.type==l&&r.abort():o==ae.getMime(a[1])?r.responseType=a[1]:o==ae.getMime("xml")?r.responseType="xml":!i.filename&&/(text|html|javascript|css)/.test(o)||(r.responseType=re.L(n));else if(4===p){if(e.type==l)return c(i);let s=r.response;return re.blob(s)&&(s=re.File([s],i.filename||ae.getname(e.url),o)),200==r.status?c(s,i):((...s)=>{e.error&&e.error.apply(r,s),t(null)})(r.statusText||"net::ERR_FAILED",i,s)}})),re.func(e[X[2]])&&r.on(X[2],(t=>re.progress(e[X[2]],"",t.loaded,t.total,t))),re.func(e.postProgress)&&r.upload.on(X[2],(t=>re.progress(e.postProgress,"",t.loaded,t.total,t))),e.upload&&re.toArr(e.upload,(e=>r.upload.on(e[0],e[1])));let p,u=e.headers||{};e.overType&&r.overrideMimeType(e.overType),e.json?(p=re.toJson(e.json),s.assign(u,{Accept:[ae.getMime(a[1]),ae.getMime(a[0]),"*/*"].join()})):e.post&&(p=re.toPost(e.post)),e.type&&e.type!=l&&(r.responseType=e.type),r.open(p?"POST":"GET",re.toGet(e.url,{inajax:ne.time},e.get)),re.toArr(u,(e=>r.setRequestHeader(e[0],e[1]))),r.send(p)}))}async FetchCache(e,t,s,r){t=t||re.L(n);let a=await caches.open(r||ne.DB_NAME),i=await a.match(e);if((!i||s&&ne.date-S.parse(i.headers.get("date"))>s)&&(i=await N(e),i&&a.put(i.url,i.clone())),i)return i[t]()}addJS(e,t,r,a){return re.Async((a=>{r=r||re.buf(e)&&(e.type&&/css$/.test(e.type)||e.name&&/css$/.test(e.name));var n=ae.URL(e),i=ne.$ce(r?"link":"script");s.assign(i,{type:ae.getMime(r?"css":"js"),href:n,src:n,rel:K.name,crossorigin:"anonymous",onload(s){e!=n&&ae.reURL(n),e=null,a(t&&t(s))},onerror(e){this.onload(e)}}),ne.$append(r?w.head:w.body,i)}))}async loadLibjs(e,t,s,r,a){return await ne.addJS(await ae.getLibjs(e,t,s,r,a),null,"css"==ae.getExt(e))}async unFile(e,t,r){return new se(s.assign(r||{},{contents:e,onprogress:t})).result}customElement(e){!E.get(e)&&E.define(e,Q)}Err(e){return new Error(e)}async download(e,t,s){let r;!t&&e&&(t=e,e=null),/^(http|blob:|data:)/.test(t)?(r=t,!e&&/^(http|blob:)/.test(t)&&(e=ae.getname(t))):t&&(r=ae.URL(t,s),e||(e=t.name||ne.ts[3]+"."+(await ae.CheckExt(t)||ne.ts[3])));let a=ne.$ce("a");a.href=r,a.download=e||"test.txt",a.click(),a.remove()}triger(e,t,s){return e=ne.$(e),s||(s={detail:e}),re.evt(t)?ne.dispatch(e,t):ne.dispatch(e,new z(t,s)),e}dispatch(e,t){return e.dispatchEvent(t),e}setClass(e){(e=e||new class extends Z{}).action=e.action||{};var{RF:t,CF:s,BF:r}=this;return re.defines(e,{I:re,T:ne,F:ae,RF:{value:t},CF:{value:s},BF:{value:r}},!0),e}onEvent(e,t,s,r,a){return e=ne.$(e),t.split(/\s+/).forEach((t=>e.on(t,s,!1===r?{passive:!1}:r,a))),e}unEvent(e,t,s,r,a){return e=ne.$(e),t.split(/\s+/).forEach((t=>e.un(t,s,!1===r?{passive:!1}:r,a))),e}onceEvent(e,t,s,r){return e.once(t,s,{passive:!1,once:!0},r)}docload(e){if(w.readyState!=ne.readyState)return e&&e.call(ne);w.once("DOMContentLoaded",e)}$(e,t){return e?re.str(e)?(t||w).querySelector(e):re.func(e)?ne.docload(e):e:M}$$(e,t){return(t||w).querySelectorAll(e)||[]}$ce(e){return w.createElement(e)}$ct(e,t,s){let r=ne.$ce(e);return t&&(r.innerHTML=re.str(t)?t:t()),re.Attr(r,s?re.str(s)?{class:s}:s:M),r}$append(e,t){return re.str(t)&&(t=ne.$ce(t)),e.appendChild(t),t}$add(e,t){return e.classList.add(t),e}async getItemAppend(e,t,s){let r=ne.part,a=e.split(r)[0],n=re.toArr(t.filesize/ne.maxsize+1).map((async(n,i)=>{let o=a;return i>0&&(o+=r+i),e==o?t.contents:(await D.GET_ITEM(o,s)).contents})),i=re.File(await re.Async(n),a,t.filetype);return t.contents=null,i}docElm(e,t){return re.dElm(e,t||w.contentType)}RF(e,t){const s=this.action[e];return re.func(s)?s.apply(this,t||[]):s}CF(e,...t){return this.RF(e,t)}BF(e,...t){const s=this.action,r=t.shift();return re.func(s[e])?t.length?this.RF(e):s[e].apply(r,t):s[e]}getLang(e,t){return ne.GL(e,t)}GL(e,t){return re.none(ne.lang[e])||(e=ne.lang[e]),t?ne.toReplace(e,t):e}toReplace(e,t){return re.str(t)?e=e.replace(/{value}/,t):re.obj(t)&&re.toArr(t,(t=>e.replace(new b(t[0],"g"),t[1]))),e}MediaQuery(e,t){if(_){let s=_(e);s.on("change",(e=>t(e.matches,e))),t(s.matches)}}MediaMath(e){return W.matchMedium(e)}async toZip(e,t,s){typeof zip===re.TP()&&await ne.loadLibjs(ne.zipsrc,t);const r=new zip.BlobWriter,a=new zip.ZipWriter(r,{password:s});if(!e)return a;if(re.none(e.length)){if(!re.obj(e))return a;re.toArr(e).map((e=>a.add(e[0],new zip.Uint8ArrayReader(e[1]),{onprogress:(s,r)=>re.progress(t,e[0],s,r)})))}else re.toArr(e).map((e=>a.add(e.name,new zip.BlobReader(e),{onprogress:(s,r)=>re.progress(t,e.name,s,r)})));return await a.close({onprogress:(e,s)=>re.progress(t,"enZip",e,s)}),await r.getData()}PostMessage(e){var t=this.sw;return t&&t.postMessage(e)}async openServiceWorker(e){var{serviceWorker:t}=navigator;t.register(e).then((e=>{var t;e.installing?(t=e.installing,this._PWAReady(!0)):e.active&&(t=e.active),t.on("statechange",(e=>{this.sendClient(e.target.active),ne.CF("pwa_statechange",e)})),w.on("visibilitychange",(function(){"visible"===w.visibilityState&&ne.sendClient(t)})),this.sendClient(t),ne.sw=t,e.on("updatefound",(e=>{this.sendClient(e.target.active),ne.CF("pwa_updatefound",e)}))}))}clearWorker(e){navigator.serviceWorker.getRegistrations().then((t=>t.forEach((t=>{t.active&&(e&&t.active.scriptURL.includes(e)?t.unregister():e||t.unregister())}))))}sendClient(e){e&&(e.postMessage({action:"CLIENT"}),e!=this.sw&&(this.sw=e))}setWorker(e){return e.on(X[1],(function(e){ne.clearWorker(),ne.CF("pwa_error",e)})),e.on("message",(async function(e){let t=e.data;if(ne.isLocal&&V.log(t),re.obj(t)){let{action:e,from:s}=t;if(e)if(re.str(e)){if("GETDBNAME"==e)return ne.docload((()=>{ne.PostMessage({action:"WOKERDBNAME",result:ne.DB_NAME})}));let s=await ne.CF(e,t);t.id?(t.result=s,ne.PostMessage(t)):ne.PostMessage(s)}else re.array(e)&&re.FM(e,(e=>[e,ne[e]||win[e]]));else s&&ne.CF(s,t)}})),!0}constructor(){super();var e=this;s.assign(Z.prototype,{on(e,t,s){return this.addEventListener(e,t,s)},un(e,t,s){return this.removeEventListener(e,t,s)},once(e,t,r){return this.addEventListener(e,t,s.assign({passive:!1,once:!0},!0===r?{passive:!0}:r||{}))},toEvent(e,t){this.dispatchEvent(new z(e,{detail:t}))}});var{language:t,serviceWorker:a,onLine:n}=navigator,{contentType:i,readyState:o,ontouchend:c,currentScript:l,characterSet:p}=w,d=l&&l.src.split("?"),h=d&&d[0].split("/").slice(0,-1).join("/")+"/",m=re.toLow(t).split("-");h&&(h=h.replace("static/","")),"zh"==m[0]&&("cn"==m[1]?m[1]="hans":"hk"!=m[1]&&(m[1]="hant")),s.assign(e,{JSpath:h,ROOT:h&&h.replace("assets/js/","")||O.pathname,langName:m[0],i18nName:m.join("-"),charset:re.toLow(p),language:t,onLine:n,readyState:o,isTouch:re.hasOwnProp(v,"ontouchstart"),ts:[re.L(g),re.L(C),ae.getType(i),i,re.L(r)]}),a&&(e.setWorker(a),e.sw=a.controller,e.PWAReady=new u((t=>{e.sw?t(!0):e._PWAReady=t})))}};e.onerror=(e,t,s,r,a)=>U(e+s+t),e.T=ne,re.defines(e,{Nenge:()=>ne},1)}));