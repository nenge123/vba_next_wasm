!function(t){"use strict";var e=function(){},n={getType:function(){return"null"},isSupported:function(){return!1},update:e},i=function(t){var n=this,i=window;this.update=e,this.requestAnimationFrame=t||i.requestAnimationFrame||i.webkitRequestAnimationFrame||i.mozRequestAnimationFrame,this.tickFunction=function(){n.update(),n.startTicker()},this.startTicker=function(){n.requestAnimationFrame.apply(i,[n.tickFunction])}};i.prototype.start=function(t){this.update=t||e,this.startTicker()};var r=function(){};r.prototype.update=e,r.prototype.start=function(t){this.update=t||e};var o=function(t,e){this.listener=t,this.gamepadGetter=e,this.knownGamepads=[]};o.factory=function(t){var e=n,i=window&&window.navigator;return i&&(void 0!==i.getGamepads?e=new o(t,(function(){return i.getGamepads()})):void 0!==i.webkitGamepads?e=new o(t,(function(){return i.webkitGamepads()})):void 0!==i.webkitGetGamepads&&(e=new o(t,(function(){return i.webkitGetGamepads()})))),e},o.getType=function(){return"WebKit"},o.prototype.getType=function(){return o.getType()},o.prototype.isSupported=function(){return!0},o.prototype.update=function(){var t,e,n=this,i=Array.prototype.slice.call(this.gamepadGetter(),0);for(e=this.knownGamepads.length-1;e>=0;e--)t=this.knownGamepads[e],i.indexOf(t)<0&&(this.knownGamepads.splice(e,1),this.listener._disconnect(t));for(e=0;e<i.length;e++)(t=i[e])&&n.knownGamepads.indexOf(t)<0&&(n.knownGamepads.push(t),n.listener._connect(t))};var a=function(t){this.listener=t,window.addEventListener("gamepadconnected",(function(e){t._connect(e.gamepad)})),window.addEventListener("gamepaddisconnected",(function(e){t._disconnect(e.gamepad)}))};a.factory=function(t){var e=n;return window&&void 0!==window.addEventListener&&(e=new a(t)),e},a.getType=function(){return"Firefox"},a.prototype.getType=function(){return a.getType()},a.prototype.isSupported=function(){return-1!==(window&&window.navigator).userAgent.indexOf("Firefox")},a.prototype.update=e;var s=function(t){this.updateStrategy=t||new i,this.gamepads=[],this.listeners={},this.platform=n,this.deadzone=.03,this.maximizeThreshold=.97};s.UpdateStrategies={AnimFrameUpdateStrategy:i,ManualUpdateStrategy:r},s.PlatformFactories=[a.factory,o.factory],s.Type={N64:"n64",PLAYSTATION:"playstation",LOGITECH:"logitech",XBOX:"xbox",UNKNOWN:"unknown"},s.Event={CONNECTED:"connected",UNSUPPORTED:"unsupported",DISCONNECTED:"disconnected",TICK:"tick",BUTTON_DOWN:"button-down",BUTTON_UP:"button-up",AXIS_CHANGED:"axis-changed"},s.StandardButtons=["FACE_1","FACE_2","FACE_3","FACE_4","LEFT_TOP_SHOULDER","RIGHT_TOP_SHOULDER","LEFT_BOTTOM_SHOULDER","RIGHT_BOTTOM_SHOULDER","SELECT_BACK","START_FORWARD","LEFT_STICK","RIGHT_STICK","DPAD_UP","DPAD_DOWN","DPAD_LEFT","DPAD_RIGHT","HOME"],s.StandardAxes=["LEFT_STICK_X","LEFT_STICK_Y","RIGHT_STICK_X","RIGHT_STICK_Y"];var p,u=function(t,e,n){return e<t.length?t[e]:n+(e-t.length+1)};s.StandardMapping={env:{},buttons:{byButton:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]},axes:{byAxis:[0,1,2,3]}},s.Mappings=[{env:{platform:a.getType(),type:s.Type.N64},buttons:{byButton:[2,1,3,0,4,5,-1,-1,8,9,-1,-1,12,13,14,15,-1]},axes:{byAxis:[1,2,-1,-1]}},{env:{platform:o.getType(),type:s.Type.N64},buttons:{byButton:[2,1,3,0,4,5,-1,-1,8,9,-1,-1,12,13,14,15,-1]},axes:{byAxis:[0,1,-1,-1]}},{env:{platform:a.getType(),type:s.Type.XBOX},buttons:{byButton:[0,1,2,3,4,5,15,16,9,8,6,7,11,12,13,14,10]},axes:{byAxis:[0,1,2,3]}},{env:{platform:a.getType(),type:s.Type.PLAYSTATION},buttons:{byButton:[14,13,15,12,10,11,8,9,0,3,1,2,4,6,7,5,16]},axes:{byAxis:[0,1,2,3]}},{env:{platform:o.getType(),type:s.Type.LOGITECH},buttons:{byButton:[1,2,0,3,4,5,6,7,8,9,10,11,11,12,13,14,10]},axes:{byAxis:[0,1,2,3]}},{env:{platform:a.getType(),type:s.Type.LOGITECH},buttons:{byButton:[0,1,2,3,4,5,-1,-1,6,7,8,9,11,12,13,14,10],byAxis:[-1,-1,-1,-1,-1,-1,[2,0,1],[2,0,-1]]},axes:{byAxis:[0,1,3,4]}}],s.prototype.init=function(){var t=s.resolvePlatform(this),e=this;return this.platform=t,this.updateStrategy.start((function(){e._update()})),t.isSupported()},s.prototype.bind=function(t,e){return void 0===this.listeners[t]&&(this.listeners[t]=[]),this.listeners[t].push(e),this},s.prototype.unbind=function(t,e){if(void 0!==t){if(void 0!==e){if(void 0===this.listeners[t])return!1;for(var n=0;n<this.listeners[t].length;n++)if(this.listeners[t][n]===e)return this.listeners[t].splice(n,1),!0;return!1}this.listeners[t]=[]}else this.listeners={}},s.prototype.count=function(){return this.gamepads.length},s.prototype._fire=function(t,e){if(void 0!==this.listeners[t])for(var n=0;n<this.listeners[t].length;n++)this.listeners[t][n].apply(this.listeners[t][n],[e])},s.getNullPlatform=function(){return Object.create(n)},s.resolvePlatform=function(t){var e,i=n;for(e=0;!i.isSupported()&&e<s.PlatformFactories.length;e++)i=s.PlatformFactories[e](t);return i},s.prototype._connect=function(t){var e,n,i=this._resolveMapping(t);for(t.state={},t.lastState={},t.updater=[],e=i.buttons.byButton.length,n=0;n<e;n++)this._addButtonUpdater(t,i,n);for(e=i.axes.byAxis.length,n=0;n<e;n++)this._addAxisUpdater(t,i,n);this.gamepads[t.index]=t,this._fire(s.Event.CONNECTED,t)},s.prototype._addButtonUpdater=function(t,e,n){var i,r=u(s.StandardButtons,n,"EXTRA_BUTTON_"),o=this._createButtonGetter(t,e.buttons,n),a=this,p={gamepad:t,control:r};t.state[r]=0,t.lastState[r]=0,i=function(){var e=o(),n=t.lastState[r],i=e>.5,u=n>.5;t.state[r]=e,i&&!u?a._fire(s.Event.BUTTON_DOWN,Object.create(p)):!i&&u&&a._fire(s.Event.BUTTON_UP,Object.create(p)),0!==e&&1!==e&&e!==n&&a._fireAxisChangedEvent(t,r,e),t.lastState[r]=e},t.updater.push(i)},s.prototype._addAxisUpdater=function(t,e,n){var i,r=u(s.StandardAxes,n,"EXTRA_AXIS_"),o=this._createAxisGetter(t,e.axes,n),a=this;t.state[r]=0,t.lastState[r]=0,i=function(){var e=o(),n=t.lastState[r];t.state[r]=e,e!==n&&a._fireAxisChangedEvent(t,r,e),t.lastState[r]=e},t.updater.push(i)},s.prototype._fireAxisChangedEvent=function(t,e,n){var i={gamepad:t,axis:e,value:n};this._fire(s.Event.AXIS_CHANGED,i)},s.prototype._createButtonGetter=(p=function(){return 0},function(t,e,n){var i,r,o=p,a=this;return-1!==(i=e.byButton[n])?"number"==typeof i&&i<t.buttons.length&&(o=function(){var e=t.buttons[i];return"number"==typeof e?e:"number"==typeof e.value?e.value:0}):e.byAxis&&n<e.byAxis.length&&(i=e.byAxis[n],r=i,"[object Array]"===Object.prototype.toString.call(r)&&3==i.length&&i[0]<t.axes.length&&(o=function(t,e,n){var i=p;return e<n?i=function(){var i=n-e,r=t();return(r=(r-e)/i)<0?0:r}:n<e&&(i=function(){var i=e-n,r=t();return(r=(r-n)/i)>1?0:1-r}),i}(o=function(){var e=t.axes[i[0]];return a._applyDeadzoneMaximize(e)},i[1],i[2]))),o}),s.prototype._createAxisGetter=function(){var t=function(){return 0};return function(e,n,i){var r,o=t,a=this;return-1!==(r=n.byAxis[i])&&"number"==typeof r&&r<e.axes.length&&(o=function(){var t=e.axes[r];return a._applyDeadzoneMaximize(t)}),o}}(),s.prototype._disconnect=function(t){var e,n=[];for(void 0!==this.gamepads[t.index]&&delete this.gamepads[t.index],e=0;e<this.gamepads.length;e++)void 0!==this.gamepads[e]&&(n[e]=this.gamepads[e]);this.gamepads=n,this._fire(s.Event.DISCONNECTED,t)},s.prototype._resolveControllerType=function(t){return-1!==(t=t.toLowerCase().replace(/\s+/g," ").replace(/^\s+|\s+$/g,"")).indexOf("playstation")?s.Type.PLAYSTATION:-1!==t.indexOf("logitech")||-1!==t.indexOf("wireless gamepad")?s.Type.LOGITECH:-1!==t.indexOf("xbox")||-1!==t.indexOf("360")?s.Type.XBOX:-1!==t.indexOf("79-6-generic")&&-1!==t.indexOf("joystick")||-1!==t.indexOf("vendor: 0079 product: 0006")&&-1!==t.indexOf("generic usb joystick")?s.Type.N64:s.Type.UNKNOWN},s.prototype._resolveMapping=function(t){var e,n,i=s.Mappings,r=null,o={platform:this.platform.getType(),type:this._resolveControllerType(t.id)};for(e=0;!r&&e<i.length;e++)n=i[e],s.envMatchesFilter(n.env,o)&&(r=n);return r||s.StandardMapping},s.envMatchesFilter=function(t,e){var n,i=!0;for(n in t)t[n]!==e[n]&&(i=!1);return i},s.prototype._update=function(){this.platform.update(),this.gamepads.forEach((function(t){t&&t.updater.forEach((function(t){t()}))})),this.gamepads.length>0&&this._fire(s.Event.TICK,this.gamepads)},s.prototype._applyDeadzoneMaximize=function(t,e,n){return e=void 0!==e?e:this.deadzone,n=void 0!==n?n:this.maximizeThreshold,t>=0?t<e?t=0:t>n&&(t=1):t>-e?t=0:t<-n&&(t=-1),t},t.Gamepad=s}("undefined"!=typeof module&&module.exports||window);